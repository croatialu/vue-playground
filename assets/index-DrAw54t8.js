var jo=Object.defineProperty;var Wo=(e,t,r)=>t in e?jo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Pt=(e,t,r)=>(Wo(e,typeof t!="symbol"?t+"":t,r),r);import{p as Ho,s as Ko,j as Qo,d as zo,b as Go,k as Jo}from"./index-yZLaS7y2.js";function ot(e){"@babel/helpers - typeof";return ot=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(e)}function Vo(e,t){if(ot(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ot(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Yo(e){var t=Vo(e,"string");return ot(t)=="symbol"?t:t+""}function Cn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yo(n.key),n)}}function we(e,t,r){return t&&Cn(e.prototype,t),r&&Cn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function gi(e){return Array.isArray(e)?e.slice(0):[e]}function Ue(e){return Array.isArray(e)}function Xo(e){return e!=null}function tr(e,t){var r=0,n=-1;for(var i of e){n=n+1;var s=t(i,n);if(s)r=r+1;else break}return r}function at(e,t){for(var r=t.length,n=0;n<r;++n){var i=t[n];e.push(i)}}function Cr(e){var t=e.split("-");if(t.length!==2)throw new Error("malformatted revision: "+e);return{height:parseInt(t[0],10),hash:t[1]}}function Rn(e){var t=parseInt(e.split("-")[0],10);return t}function Rr(e,t){var r=t?t._rev:null,n=r?Cr(r).height:0,i=n+1;return i+"-"+e}function bi(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&(typeof e[t]=="object"||typeof e[t]=="function")&&!Object.isFrozen(e[t])&&bi(e[t])}),e}function wi(e){var t=e.split("."),r=t.length;return r===1?n=>n[e]:n=>{for(var i=n,s=0;s<r;++s){var o=t[s];if(i=i[o],typeof i>"u")return i}return i}}function Dr(e){var t={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))if(typeof e[r]=="object"){var n=Dr(e[r]);for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[r+"."+i]=n[i])}else t[r]=e[r];return t}function L(e){return Object.assign({},e)}function Zo(e){return Object.keys(e)[0]}function Nt(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((n,i)=>typeof n=="string"&&typeof i=="string"?n.localeCompare(i):typeof n=="object"?1:-1).map(n=>Nt(n,t));if(typeof e=="object"&&!Array.isArray(e)){var r={};return Object.keys(e).sort((n,i)=>n.localeCompare(i)).forEach(n=>{r[n]=Nt(e[n],t)}),r}return e}function xr(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=xr(e[r]);return t}var n={};for(var i in e)n[i]=xr(e[i]);return n}var je=xr;function pe(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}var _i=1;function zt(){return{lwt:_i}}function mt(){return""}function ea(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function ta(e,t,r){if(t.length!==r.length)return!1;for(var n=0,i=t.length;n<i;){var s=t[n],o=r[n];if(n++,s._rev!==o._rev||s[e]!==o[e])return!1}return!0}class ve{constructor(t,r){t=this.words=t||[],this.sigBytes=r===void 0?t.length*4:r}toString(t){return(t||ra).stringify(this)}concat(t){if(this.clamp(),this.sigBytes%4)for(let r=0;r<t.sigBytes;r++){const n=t.words[r>>>2]>>>24-r%4*8&255;this.words[this.sigBytes+r>>>2]|=n<<24-(this.sigBytes+r)%4*8}else for(let r=0;r<t.sigBytes;r+=4)this.words[this.sigBytes+r>>>2]=t.words[r>>>2];return this.sigBytes+=t.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new ve([...this.words])}}const ra={stringify(e){const t=[];for(let r=0;r<e.sigBytes;r++){const n=e.words[r>>>2]>>>24-r%4*8&255;t.push((n>>>4).toString(16),(n&15).toString(16))}return t.join("")}},na={parse(e){const t=e.length,r=[];for(let n=0;n<t;n++)r[n>>>2]|=(e.charCodeAt(n)&255)<<24-n%4*8;return new ve(r,t)}},ia={parse(e){return na.parse(unescape(encodeURIComponent(e)))}};class sa{constructor(){this._data=new ve,this._nDataBytes=0,this._minBufferSize=0,this.blockSize=512/32}reset(){this._data=new ve,this._nDataBytes=0}_append(t){typeof t=="string"&&(t=ia.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_doProcessBlock(t,r){}_process(t){let r,n=this._data.sigBytes/(this.blockSize*4);t?n=Math.ceil(n):n=Math.max((n|0)-this._minBufferSize,0);const i=n*this.blockSize,s=Math.min(i*4,this._data.sigBytes);if(i){for(let o=0;o<i;o+=this.blockSize)this._doProcessBlock(this._data.words,o);r=this._data.words.splice(0,i),this._data.sigBytes-=s}return new ve(r,s)}}class oa extends sa{update(t){return this._append(t),this._process(),this}finalize(t){t&&this._append(t)}}const Dn=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],aa=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Ce=[];class ua extends oa{constructor(){super(...arguments),this._hash=new ve([...Dn])}reset(){super.reset(),this._hash=new ve([...Dn])}_doProcessBlock(t,r){const n=this._hash.words;let i=n[0],s=n[1],o=n[2],a=n[3],u=n[4],c=n[5],l=n[6],f=n[7];for(let h=0;h<64;h++){if(h<16)Ce[h]=t[r+h]|0;else{const w=Ce[h-15],I=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,_=Ce[h-2],E=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;Ce[h]=I+Ce[h-7]+E+Ce[h-16]}const d=u&c^~u&l,v=i&s^i&o^s&o,p=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),g=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),b=f+g+d+aa[h]+Ce[h],y=p+v;f=l,l=c,c=u,u=a+b|0,a=o,o=s,s=i,i=b+y|0}n[0]=n[0]+i|0,n[1]=n[1]+s|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0}finalize(t){super.finalize(t);const r=this._nDataBytes*8,n=this._data.sigBytes*8;return this._data.words[n>>>5]|=128<<24-n%32,this._data.words[(n+64>>>9<<4)+14]=Math.floor(r/4294967296),this._data.words[(n+64>>>9<<4)+15]=r,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}}function ca(e){return new ua().finalize(e).toString()}function la(e){return Promise.resolve(ca(e))}async function fa(e){var t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t),n=Array.prototype.map.call(new Uint8Array(r),i=>("00"+i.toString(16)).slice(-2)).join("");return n}var ha=typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.digest=="function",da=ha?fa:la;function ma(){return new Promise(e=>setTimeout(e,0))}function pa(e=0){return new Promise(t=>setTimeout(t,e))}var ut=Promise.resolve(!0),le=Promise.resolve(!1),va=Promise.resolve(null),ye=Promise.resolve();function Qr(e=1e4){return typeof requestIdleCallback=="function"?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):pa(0)}var rr=ye;function ya(e=void 0){return rr=rr.then(()=>Qr(e)),rr}function ga(e,t){return e.reduce((r,n)=>r.then(n),Promise.resolve(t))}var ba=/\./g,xn="abcdefghijklmnopqrstuvwxyz";function pt(e=10){for(var t="",r=0;r<e;r++)t+=xn.charAt(Math.floor(Math.random()*xn.length));return t}function Oi(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function fe(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}function Ei(e){return!!(e.includes("/")||e.includes("\\"))}function We(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!We(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var i=Object.keys(e);if(r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;for(n=r;n--!==0;){var s=i[n];if(!We(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}var wa=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},nr=new Set(["__proto__","prototype","constructor"]),_a=new Set("0123456789");function Oa(e){var t=[],r="",n="start",i=!1;for(var s of e)switch(s){case"\\":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");i&&(r+=s),n="property",i=!i;break}case".":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="property";break}if(i){i=!1,r+=s;break}if(nr.has(r))return[];t.push(r),r="",n="property";break}case"[":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="index";break}if(i){i=!1,r+=s;break}if(n==="property"){if(nr.has(r))return[];t.push(r),r=""}n="index";break}case"]":{if(n==="index"){t.push(Number.parseInt(r,10)),r="",n="indexEnd";break}if(n==="indexEnd")throw new Error("Invalid character after an index")}default:{if(n==="index"&&!_a.has(s))throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");n==="start"&&(n="property"),i&&(i=!1,r+="\\"),r+=s}}switch(i&&(r+="\\"),n){case"property":{if(nr.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function Ea(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function he(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!wa(e)||typeof t!="string")return r===void 0?e:r;var n=Oa(t);if(n.length===0)return r;for(var i=0;i<n.length;i++){var s=n[i];if(Ea(e,s)?e=i===n.length-1?void 0:null:e=e[s],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function ct(e,t){var r=e.get(t);if(typeof r>"u")throw new Error("missing value from map "+t);return r}function be(e,t,r,n){var i=e.get(t);return typeof i>"u"?(i=r(),e.set(t,i)):n&&n(i),i}function C(e){var t=e.split("-"),r="RxDB";return t.forEach(n=>{r+=Oi(n)}),r+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.
        You should either prevent the usage of this function or add the plugin via:
            import { `+r+" } from 'rxdb/plugins/"+e+`';
            addRxPlugin(`+r+`);
        `)}var ir=0;function Q(){var e=Date.now();e=e+.01,e<=ir&&(e=ir+.01);var t=parseFloat(e.toFixed(2));return ir=t,t}function x(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}var Si={bufferSize:1,refCount:!0},Ci="15.17.0";function lt(e,t){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},lt(e,t)}function Ri(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,lt(e,t)}function Ir(e){return Ir=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ir(e)}function Sa(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function Di(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Di=function(){return!!e})()}function Ca(e,t,r){if(Di())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&lt(i,r.prototype),i}function Bt(e){var t=typeof Map=="function"?new Map:void 0;return Bt=function(n){if(n===null||!Sa(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Ca(n,arguments,Ir(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),lt(i,n)},Bt(e)}var M={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return"RxDB Error-Code "+e+`.
        Error messages are not included in RxDB core to reduce build size.
        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html
        - or search for the error code here: https://github.com/pubkey/rxdb/search?q=`+e+`
        `}};function Ra(e){var t="";return Object.keys(e).length===0||(t+=`Given parameters: {
`,t+=Object.keys(e).map(r=>{var n="[object Object]";try{r==="errors"?n=e[r].map(i=>JSON.stringify(i,Object.getOwnPropertyNames(i))):n=JSON.stringify(e[r],function(i,s){return s===void 0?null:s},2)}catch{}return r+":"+n}).join(`
`),t+="}"),t}function xi(e,t,r){return"RxError ("+t+`):
`+e+`
`+Ra(r)}var Da=function(e){function t(n,i,s={}){var o,a=xi(i,n,s);return o=e.call(this,a)||this,o.code=n,o.message=a,o.parameters=s,o.rxdb=!0,o}Ri(t,e);var r=t.prototype;return r.toString=function(){return this.message},we(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])}(Bt(Error)),xa=function(e){function t(n,i,s={}){var o,a=xi(i,n,s);return o=e.call(this,a)||this,o.code=n,o.message=a,o.parameters=s,o.rxdb=!0,o}Ri(t,e);var r=t.prototype;return r.toString=function(){return this.message},we(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])}(Bt(TypeError));function m(e,t){return new Da(e,M.tunnelErrorMessage(e),t)}function z(e,t){return new xa(e,M.tunnelErrorMessage(e),t)}function Ii(e){return e&&e.status===409?e:!1}var Ia={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function Pa(e){return m("COL20",{name:Ia[e.status],document:e.documentId,writeError:e})}var ft={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postDestroyRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preMigrateDocument:[],postMigrateDocument:[],preDestroyRxDatabase:[],postRemoveRxDatabase:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function X(e,t){ft[e]&&ft[e].forEach(r=>r(t))}function vt(e,t){return Promise.all(ft[e].map(r=>r(t)))}function Z(e,t){var r=t;r=r.replace(ba,".properties."),r="properties."+r,r=fe(r);var n=he(e,r);return n}function Pi(e,t,r){if(typeof t.primaryKey=="string")return r;var n=zr(t,r),i=r[e];if(i&&i!==n)throw m("DOC19",{args:{documentData:r,existingPrimary:i,newPrimary:n},schema:t});return r[e]=n,r}function ce(e){return typeof e=="string"?e:e.key}function zr(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(n=>{var i=he(t,n);if(typeof i>"u")throw m("DOC18",{args:{field:n,documentData:t}});return i}).join(r.separator)}function ka(e){var t=Nt(e,!0);return t}function Ma(e){return["_deleted",e]}function ki(e){e=L(e);var t=ce(e.primaryKey);e.properties=L(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=Aa,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=Mi(e);at(e.required,r),e.required=e.required.filter(s=>!s.includes(".")).filter((s,o,a)=>a.indexOf(s)===o),e.version=e.version||0;var n=e.indexes.map(s=>{var o=Ue(s)?s.slice(0):[s];return o.includes(t)||o.push(t),o[0]!=="_deleted"&&o.unshift("_deleted"),o});n.length===0&&n.push(Ma(t)),n.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(s=>{n.push(s)});var i=new Set;return n.filter(s=>{var o=s.join(",");return i.has(o)?!1:(i.add(o),!0)}),e.indexes=n,e}var Aa={type:"object",properties:{lwt:{type:"number",minimum:_i,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function Mi(e){var t=Object.keys(e.properties).filter(n=>e.properties[n].final),r=ce(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(n=>t.push(n)),t}function La(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var i=r[n];(!Object.prototype.hasOwnProperty.call(t,i)||typeof t[i]>"u")&&(t[i]=e.defaultValues[i])}return t}var Ai=function(){function e(r,n){this.jsonSchema=r,this.hashFunction=n,this.indexes=Ta(this.jsonSchema),this.primaryPath=ce(this.jsonSchema.primaryKey),this.finalFields=Mi(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(n,i){this.finalFields.forEach(s=>{if(!We(n[s],i[s]))throw m("DOC9",{dataBefore:n,dataAfter:i,fieldName:s,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var n={},i=Z(this.jsonSchema,"");return Object.keys(i).forEach(s=>{var o=s;n.__defineGetter__(s,function(){if(!(!this.get||typeof this.get!="function")){var a=this.get(o);return a}}),Object.defineProperty(n,s+"$",{get:function(){return this.get$(o)},enumerable:!1,configurable:!1}),Object.defineProperty(n,s+"$$",{get:function(){return this.get$$(o)},enumerable:!1,configurable:!1}),Object.defineProperty(n,s+"_",{get:function(){return this.populate(o)},enumerable:!1,configurable:!1})}),pe(this,"getDocumentPrototype",()=>n),n},t.getPrimaryOfDocumentData=function(n){return zr(this.jsonSchema,n)},we(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var r={};return Object.entries(this.jsonSchema.properties).filter(([,n])=>Object.prototype.hasOwnProperty.call(n,"default")).forEach(([n,i])=>r[n]=i.default),pe(this,"defaultValues",r)}},{key:"hash",get:function(){return pe(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])}();function Ta(e){return(e.indexes||[]).map(t=>Ue(t)?t:[t])}function $a(e){var t=e.version?e.version:0,r=0;return new Array(t).fill(0).map(()=>r++)}function Na(e,t,r=!0){r&&X("preCreateRxSchema",e);var n=ki(e);n=ka(n),M.deepFreezeWhenDevMode(n);var i=new Ai(n,t);return X("createRxSchema",i),i}function A(e){return typeof e=="function"}function Ba(e){return A(e==null?void 0:e.lift)}function _e(e){return function(t){if(Ba(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var Pr=function(e,t){return Pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Pr(e,t)};function $e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Pr(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Fa(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((n=n.apply(e,t||[])).next())})}function Li(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(r=0)),r;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(l){c=[6,l],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function He(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ft(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Ut(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function qe(e){return this instanceof qe?(this.v=e,this):new qe(e)}function Ua(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(d){return new Promise(function(v,p){s.push([h,d,v,p])>1||a(h,d)})})}function a(h,d){try{u(n[h](d))}catch(v){f(s[0][3],v)}}function u(h){h.value instanceof qe?Promise.resolve(h.value.v).then(c,l):f(s[0][2],h)}function c(h){a("next",h)}function l(h){a("throw",h)}function f(h,d){h(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function qa(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof He=="function"?He(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(o){return new Promise(function(a,u){o=e[s](o),i(a,u,o.done,o.value)})}}function i(s,o,a,u){Promise.resolve(u).then(function(c){s({value:c,done:a})},o)}}var Ti=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function $i(e){return A(e==null?void 0:e.then)}function Gr(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var sr=Gr(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function kr(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Gt=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=He(o),u=a.next();!u.done;u=a.next()){var c=u.value;c.remove(this)}}catch(p){t={error:p}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else o.remove(this);var l=this.initialTeardown;if(A(l))try{l()}catch(p){s=p instanceof sr?p.errors:[p]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var h=He(f),d=h.next();!d.done;d=h.next()){var v=d.value;try{In(v)}catch(p){s=s??[],p instanceof sr?s=Ut(Ut([],Ft(s)),Ft(p.errors)):s.push(p)}}}catch(p){n={error:p}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}if(s)throw new sr(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)In(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&kr(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&kr(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Ni=Gt.EMPTY;function Bi(e){return e instanceof Gt||e&&"closed"in e&&A(e.remove)&&A(e.add)&&A(e.unsubscribe)}function In(e){A(e)?e():e.unsubscribe()}var Fi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ui={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,Ut([e,t],Ft(r)))},clearTimeout:function(e){var t=Ui.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function qi(e){Ui.setTimeout(function(){throw e})}function Pn(){}function Lt(e){e()}var Jr=function(e){$e(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Bi(r)&&r.add(n)):n.destination=Ka,n}return t.create=function(r,n,i){return new Ke(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Gt),ja=Function.prototype.bind;function or(e,t){return ja.call(e,t)}var Wa=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){kt(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){kt(n)}else kt(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){kt(r)}},e}(),Ke=function(e){$e(t,e);function t(r,n,i){var s=e.call(this)||this,o;if(A(r)||!r)o={next:r??void 0,error:n??void 0,complete:i??void 0};else{var a;s&&Fi.useDeprecatedNextContext?(a=Object.create(r),a.unsubscribe=function(){return s.unsubscribe()},o={next:r.next&&or(r.next,a),error:r.error&&or(r.error,a),complete:r.complete&&or(r.complete,a)}):o=r}return s.destination=new Wa(o),s}return t}(Jr);function kt(e){qi(e)}function Ha(e){throw e}var Ka={closed:!0,next:Pn,error:Ha,complete:Pn},Vr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Yr(e){return e}function Qa(e){return e.length===0?Yr:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var G=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this,s=Ga(t)?t:new Ke(t,r,n);return Lt(function(){var o=i,a=o.operator,u=o.source;s.add(a?a.call(s,u):u?i._subscribe(s):i._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=kn(r),new r(function(i,s){var o=new Ke({next:function(a){try{t(a)}catch(u){s(u),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Vr]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Qa(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=kn(t),new t(function(n,i){var s;r.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},e.create=function(t){return new e(t)},e}();function kn(e){var t;return(t=e??Fi.Promise)!==null&&t!==void 0?t:Promise}function za(e){return e&&A(e.next)&&A(e.error)&&A(e.complete)}function Ga(e){return e&&e instanceof Jr||za(e)&&Bi(e)}function ji(e){return A(e[Vr])}function Wi(e){return Symbol.asyncIterator&&A(e==null?void 0:e[Symbol.asyncIterator])}function Hi(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Ja(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ki=Ja();function Qi(e){return A(e==null?void 0:e[Ki])}function zi(e){return Ua(this,arguments,function(){var r,n,i,s;return Li(this,function(o){switch(o.label){case 0:r=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,qe(r.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,qe(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,qe(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function Gi(e){return A(e==null?void 0:e.getReader)}function Oe(e){if(e instanceof G)return e;if(e!=null){if(ji(e))return Va(e);if(Ti(e))return Ya(e);if($i(e))return Xa(e);if(Wi(e))return Ji(e);if(Qi(e))return Za(e);if(Gi(e))return eu(e)}throw Hi(e)}function Va(e){return new G(function(t){var r=e[Vr]();if(A(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ya(e){return new G(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function Xa(e){return new G(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,qi)})}function Za(e){return new G(function(t){var r,n;try{for(var i=He(e),s=i.next();!s.done;s=i.next()){var o=s.value;if(t.next(o),t.closed)return}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()})}function Ji(e){return new G(function(t){tu(e,t).catch(function(r){return t.error(r)})})}function eu(e){return Ji(zi(e))}function tu(e,t){var r,n,i,s;return Fa(this,void 0,void 0,function(){var o,a;return Li(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=qa(e),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=u.sent(),i={error:a},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(s=r.return)?[4,s.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Qe(e,t,r,n,i){return new ru(e,t,r,n,i)}var ru=function(e){$e(t,e);function t(r,n,i,s,o,a){var u=e.call(this,r)||this;return u.onFinalize=o,u.shouldUnsubscribe=a,u._next=n?function(c){try{n(c)}catch(l){r.error(l)}}:e.prototype._next,u._error=s?function(c){try{s(c)}catch(l){r.error(l)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=i?function(){try{i()}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,u}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(Jr),Vi={now:function(){return(Vi.delegate||Date).now()},delegate:void 0};function nu(e){return e&&A(e.schedule)}function Yi(e){return e[e.length-1]}function Xr(e){return nu(Yi(e))?e.pop():void 0}function iu(e,t){return typeof Yi(e)=="number"?e.pop():t}function ge(e,t,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!i)return s}function Xi(e,t){return t===void 0&&(t=0),_e(function(r,n){r.subscribe(Qe(n,function(i){return ge(n,e,function(){return n.next(i)},t)},function(){return ge(n,e,function(){return n.complete()},t)},function(i){return ge(n,e,function(){return n.error(i)},t)}))})}function Zi(e,t){return t===void 0&&(t=0),_e(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function su(e,t){return Oe(e).pipe(Zi(t),Xi(t))}function ou(e,t){return Oe(e).pipe(Zi(t),Xi(t))}function au(e,t){return new G(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function uu(e,t){return new G(function(r){var n;return ge(r,t,function(){n=e[Ki](),ge(r,t,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){r.error(a);return}o?r.complete():r.next(s)},0,!0)}),function(){return A(n==null?void 0:n.return)&&n.return()}})}function es(e,t){if(!e)throw new Error("Iterable cannot be null");return new G(function(r){ge(r,t,function(){var n=e[Symbol.asyncIterator]();ge(r,t,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function cu(e,t){return es(zi(e),t)}function lu(e,t){if(e!=null){if(ji(e))return su(e,t);if(Ti(e))return au(e,t);if($i(e))return ou(e,t);if(Wi(e))return es(e,t);if(Qi(e))return uu(e,t);if(Gi(e))return cu(e,t)}throw Hi(e)}function ts(e,t){return t?lu(e,t):Oe(e)}function de(e,t){return _e(function(r,n){var i=0;r.subscribe(Qe(n,function(s){n.next(e.call(t,s,i++))}))})}function fu(e,t,r,n,i,s,o,a){var u=[],c=0,l=0,f=!1,h=function(){f&&!u.length&&!c&&t.complete()},d=function(p){return c<n?v(p):u.push(p)},v=function(p){s&&t.next(p),c++;var g=!1;Oe(r(p,l++)).subscribe(Qe(t,function(b){i==null||i(b),s?d(b):t.next(b)},function(){g=!0},void 0,function(){if(g)try{c--;for(var b=function(){var y=u.shift();o?ge(t,o,function(){return v(y)}):v(y)};u.length&&c<n;)b();h()}catch(y){t.error(y)}}))};return e.subscribe(Qe(t,d,function(){f=!0,h()})),function(){a==null||a()}}function yt(e,t,r){return r===void 0&&(r=1/0),A(t)?yt(function(n,i){return de(function(s,o){return t(n,s,i,o)})(Oe(e(n,i)))},r):(typeof t=="number"&&(r=t),_e(function(n,i){return fu(n,i,e,r)}))}function rs(e){return e===void 0&&(e=1/0),yt(Yr,e)}function hu(){return rs(1)}var du=Gr(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Me=function(e){$e(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new Mn(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new du},t.prototype.next=function(r){var n=this;Lt(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=He(n.currentObservers),a=o.next();!a.done;a=o.next()){var u=a.value;u.next(r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},t.prototype.error=function(r){var n=this;Lt(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},t.prototype.complete=function(){var r=this;Lt(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Ni:(this.currentObservers=null,a.push(r),new Gt(function(){n.currentObservers=null,kr(a,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?r.error(s):o&&r.complete()},t.prototype.asObservable=function(){var r=new G;return r.source=this,r},t.create=function(r,n){return new Mn(r,n)},t}(G),Mn=function(e){$e(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},t.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:Ni},t}(Me);function An(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hu()(ts(e,Xr(e)))}var mu=new G(function(e){return e.complete()});function Mr(e,t){return t===void 0&&(t=Yr),e=e??pu,_e(function(r,n){var i,s=!0;r.subscribe(Qe(n,function(o){var a=t(o);(s||!e(i,a))&&(s=!1,i=a,n.next(o))}))})}function pu(e,t){return e===t}function Y(e,t){return _e(function(r,n){var i=0;r.subscribe(Qe(n,function(s){return e.call(t,s,i++)&&n.next(s)}))})}var vu=Gr(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}),yu=function(e){$e(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,s=r._value;if(n)throw i;return this._throwIfClosed(),s},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(Me),gu=function(e){$e(t,e);function t(r,n,i){r===void 0&&(r=1/0),n===void 0&&(n=1/0),i===void 0&&(i=Vi);var s=e.call(this)||this;return s._bufferSize=r,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,r),s._windowTime=Math.max(1,n),s}return t.prototype.next=function(r){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,u=n._windowTime;i||(s.push(r),!o&&s.push(a.now()+u)),this._trimBuffer(),e.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),u=0;u<a.length&&!r.closed;u+=s?1:2)r.next(a[u]);return this._checkFinalizedStatuses(r),n},t.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,i=r._timestampProvider,s=r._buffer,o=r._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var u=i.now(),c=0,l=1;l<s.length&&s[l]<=u;l+=2)c=l;c&&s.splice(0,c+1)}},t}(Me);function bu(e){e===void 0&&(e={});var t=e.connector,r=t===void 0?function(){return new Me}:t,n=e.resetOnError,i=n===void 0?!0:n,s=e.resetOnComplete,o=s===void 0?!0:s,a=e.resetOnRefCountZero,u=a===void 0?!0:a;return function(c){var l,f,h,d=0,v=!1,p=!1,g=function(){f==null||f.unsubscribe(),f=void 0},b=function(){g(),l=h=void 0,v=p=!1},y=function(){var w=l;b(),w==null||w.unsubscribe()};return _e(function(w,I){d++,!p&&!v&&g();var _=h=h??r();I.add(function(){d--,d===0&&!p&&!v&&(f=ar(y,u))}),_.subscribe(I),!l&&d>0&&(l=new Ke({next:function(E){return _.next(E)},error:function(E){p=!0,g(),f=ar(b,i,E),_.error(E)},complete:function(){v=!0,g(),f=ar(b,o),_.complete()}}),Oe(w).subscribe(l))})(c)}}function ar(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t===!0){e();return}if(t!==!1){var i=new Ke({next:function(){i.unsubscribe(),e()}});return Oe(t.apply(void 0,Ut([],Ft(r)))).subscribe(i)}}function ns(e,t,r){var n,i,s,o,a=!1;return e&&typeof e=="object"?(n=e.bufferSize,o=n===void 0?1/0:n,i=e.windowTime,t=i===void 0?1/0:i,s=e.refCount,a=s===void 0?!1:s,r=e.scheduler):o=e??1/0,bu({connector:function(){return new gu(o,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function is(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Xr(e);return _e(function(n,i){(r?An(e,n,r):An(e,n)).subscribe(i)})}function ss(e){return e.documentData?e.documentData:e.previousDocumentData}function wu(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:M.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}function _u(e,t){var r=typeof t=="object";return new Promise(function(n,i){var s=new Ke({next:function(o){n(o),s.unsubscribe()},error:i,complete:function(){r?n(t.defaultValue):i(new vu)}});e.subscribe(s)})}function Ou(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Xr(e),n=iu(e,1/0),i=e;return i.length?i.length===1?Oe(i[0]):rs(n)(ts(i,r)):mu}function Zr(e){return e[e.length-1]}function Eu(e){const t=typeof e;return e!==null&&(t==="object"||t==="function")}function Ln(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!Eu(e)||typeof t!="string")return r===void 0?e:r;const n=t.split(".");if(n.length===0)return r;for(let i=0;i<n.length;i++){const s=n[i];if(Su(e,s)?e=i===n.length-1?void 0:null:e=e[s],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function Su(e,t){if(typeof t!="number"&&Array.isArray(e)){const r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}const os=e=>!!e.queryParams.limit,Cu=e=>e.queryParams.limit===1,Ru=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),Du=e=>e.changeEvent.operation==="DELETE",xu=e=>e.changeEvent.operation==="INSERT",Iu=e=>e.changeEvent.operation==="UPDATE",Pu=e=>os(e)&&e.previousResults.length>=e.queryParams.limit,ku=e=>{const t=e.queryParams.sortFields,r=e.changeEvent.previous,n=e.changeEvent.doc;if(!n)return!1;if(!r)return!0;for(let i=0;i<t.length;i++){const s=t[i],o=Ln(r,s),a=Ln(n,s);if(o!==a)return!0}return!1},Mu=e=>{const t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{const r=e.queryParams.primaryKey,n=e.previousResults;for(let i=0;i<n.length;i++)if(n[i][r]===t)return!0;return!1}},Au=e=>{const t=e.previousResults[0];return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Lu=e=>{const t=Zr(e.previousResults);return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Tu=e=>{const t=e.changeEvent.previous;if(!t)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},$u=e=>{const t=e.changeEvent.previous;if(!t)return!1;const r=Zr(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Nu=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Bu=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=Zr(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Fu=e=>{const t=e.changeEvent.previous;return t?e.queryParams.queryMatcher(t):!1},Uu=e=>{const t=e.changeEvent.doc;return t?e.queryParams.queryMatcher(t):!1},qu=e=>e.previousResults.length===0,ju={0:xu,1:Iu,2:Du,3:os,4:Cu,5:Ru,6:qu,7:Pu,8:Au,9:Lu,10:ku,11:Mu,12:Tu,13:$u,14:Nu,15:Bu,16:Fu,17:Uu};function as(e,t,r,n){var i=e.length,s=i-1,o=0;if(i===0)return e.push(t),0;for(var a;n<=s;)o=n+(s-n>>1),a=e[o],r(a,t)<=0?n=o+1:s=o-1;return r(a,t)<=0&&o++,e.splice(o,0,t),o}const Wu=e=>{},en=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},tn=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},rn=e=>{const t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},nn=e=>{const t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},Hu=e=>{rn(e),tn(e)},Ku=e=>{nn(e),en(e)},Qu=e=>{rn(e),en(e)},zu=e=>{nn(e),tn(e)},us=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);const t=e.queryParams.primaryKey,r=e.previousResults;for(let n=0;n<r.length;n++)if(r[n][t]===e.changeEvent.id){r.splice(n,1);break}},Gu=e=>{const t=e.changeEvent.doc,r=e.queryParams.primaryKey,n=e.previousResults;for(let i=0;i<n.length;i++)if(n[i][r]===e.changeEvent.id){n[i]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},Ju=e=>{const t={_id:"wrongHuman"+new Date().getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},cs=e=>{const t=e.changeEvent.id,r=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,r)}else if(e.previousResults.find(i=>i[e.queryParams.primaryKey]===t))return;as(e.previousResults,r,e.queryParams.sortComparator,0)},Vu=e=>{us(e),cs(e)},Yu=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},Xu=e=>{throw new Error("Action unknownAction should never be called")},Zu=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],ec={doNothing:Wu,insertFirst:en,insertLast:tn,removeFirstItem:rn,removeLastItem:nn,removeFirstInsertLast:Hu,removeLastInsertFirst:Ku,removeFirstInsertFirst:Qu,removeLastInsertLast:zu,removeExisting:us,replaceExisting:Gu,alwaysWrong:Ju,insertAtSortPosition:cs,removeExistingAndInsertAtSortPosition:Vu,runFullQueryAgain:Yu,unknownAction:Xu},tc=40;function ur(e){return e.charCodeAt(0)-tc}function rc(e){return e?"1":"0"}function Tn(e,t){const r=[];for(let n=0,i=e.length;n<i;n+=t)r.push(e.substring(n,n+t));return r}function nc(e){const t=new Map,n=2+parseInt(e.charAt(0)+e.charAt(1),10)*2,i=e.substring(2,n),s=Tn(i,2);for(let p=0;p<s.length;p++){const g=s[p],b=g.charAt(0),y=ur(g.charAt(1));t.set(b,y)}const o=e.substring(n,e.length-3),a=Tn(o,4);for(let p=0;p<a.length;p++){const g=a[p],b=g.charAt(0),y=g.charAt(1),w=g.charAt(2),I=ur(g.charAt(3));if(!t.has(y))throw new Error("missing node with id "+y);if(!t.has(w))throw new Error("missing node with id "+w);const _=t.get(y),E=t.get(w),O={l:I,0:_,1:E};t.set(b,O)}const u=e.slice(-3),c=u.charAt(0),l=u.charAt(1),f=ur(u.charAt(2)),h=t.get(c),d=t.get(l);return{l:f,0:h,1:d}}function ic(e,t,r){let n=e,i=e.l;for(;;){const s=t[i](r),o=rc(s);if(n=n[o],typeof n=="number"||typeof n=="string")return n;i=n.l}}const sc="14a1b,c+d2e5f0g/h.i4j*k-l)m(n6oeh6pnm6qen6ril6snh6tin6ubo9vce9wmh9xns9yne9zmi9{cm9|ad9}cp9~aq9ae9¡bf9¢bq9£cg9¤ck9¥cn9¦nd9§np9¨nq9©nf9ªng9«nm9¬nk9­mr9®ms9¯mt9°mj9±mk9²ml9³mn9´mc8µ³{8¶¯}8·°¤8¸³§8¹mn8º³«8»³m8¼m´4½z²4¾³w4¿zµ4À¯¶4Á°·4Â³º4Ã³¸4Äm¹4Åv¤7Æyn7ÇÀÁ7È~7É¥¤7ÊÃÄ7Ë¨n7Ìº¹7Í­°7Î®m7Ï¯°7Ð±m7Ñ³m7Ò¼m5ÓÄm5Ô¹m5Õ½°5Ö¾m5×¿°5ØÇÏ5ÙÂm5ÚÊÑ5Û±m5Üºm5ÝÌÑ5ÞÕÍ2ß|2à¡u2á£Å2âÖÎ2ã¦Æ2ä©x2åªÆ2æ×Ø2ç|È2è¡¢2é£É2ê¤¥2ëÙÚ2ì¦Ë2í©n2îªn2ïÛÐ2ðÜÝ2ñ¬n2òÒÓ/óan/ôbn/õcn/öÞâ/÷ßã/øàä/ùáå/úæë/ûçì/üèí/ýéî/þÍÎ/ÿÏÑ/ĀòÔ,ācn,Ăöï,ă¤ñ,Ąúð,ąêñ,ĆþÐ,ćÿÑ,Ĉac0ĉbc0Ċóõ0ċôā0Čßá0čà¤0Ďçé0ďèê0Đ÷ù0đøă0Ēûý0ēüą0ĔmÒ-ĕmĀ-ĖÞæ-ėČĎ-Ęčď-ęĂĄ-ĚĐĒ-ěđē-Ĝ²»-ĝÍÏ-ĞĆć-ğ²³-ĠĔĈ3ġĕĊ3ĢĖė3ģęĚ3ĤĢĝ(ĥĜğ(ĦģĞ(ħĠġ+Ĩĉċ+ĩĤĦ+ĪĘě+īħĨ1ĬĩĪ1ĭĬī*Įĥm*ĭĮ.";let cr;function oc(){return cr||(cr=nc(sc)),cr}const ac=e=>ic(oc(),ju,e);function uc(e){const t=ac(e);return Zu[t]}function cc(e,t,r,n,i){const s=ec[e];return s({queryParams:t,changeEvent:r,previousResults:n,keyDocumentMap:i}),n}var te="￿",re=Number.MIN_SAFE_INTEGER;function lc(e,t){var r=t.selector,n=e.indexes?e.indexes.slice(0):[];t.index&&(n=[t.index]);var i=!!t.sort.find(l=>Object.values(l)[0]==="desc"),s=new Set;Object.keys(r).forEach(l=>{var f=Z(e,l);f&&f.type==="boolean"&&Object.prototype.hasOwnProperty.call(r[l],"$eq")&&s.add(l)});var o=t.sort.map(l=>Object.keys(l)[0]),a=o.filter(l=>!s.has(l)).join(","),u=-1,c;if(n.forEach(l=>{var f=!0,h=!0,d=l.map(y=>{var w=r[y],I=w?Object.keys(w):[],_={};if(!w||!I.length){var E=h?re:te;_={startKey:E,endKey:f?te:re,inclusiveStart:!0,inclusiveEnd:!0}}else I.forEach(O=>{if(sn.has(O)){var R=w[O],T=mc(O,R);_=Object.assign(_,T)}});return typeof _.startKey>"u"&&(_.startKey=re),typeof _.endKey>"u"&&(_.endKey=te),typeof _.inclusiveStart>"u"&&(_.inclusiveStart=!0),typeof _.inclusiveEnd>"u"&&(_.inclusiveEnd=!0),h&&!_.inclusiveStart&&(h=!1),f&&!_.inclusiveEnd&&(f=!1),_}),v=d.map(y=>y.startKey),p=d.map(y=>y.endKey),g={index:l,startKeys:v,endKeys:p,inclusiveEnd:f,inclusiveStart:h,sortSatisfiedByIndex:!i&&a===l.filter(y=>!s.has(y)).join(","),selectorSatisfiedByIndex:dc(l,t.selector,v,p)},b=pc(e,t,g);(b>=u||t.index)&&(u=b,c=g)}),!c)throw m("SNH",{query:t});return c}var sn=new Set(["$eq","$gt","$gte","$lt","$lte"]),fc=new Set(["$eq","$gt","$gte"]),hc=new Set(["$eq","$lt","$lte"]);function dc(e,t,r,n){var i=Object.entries(t),s=i.find(([O,R])=>{if(!e.includes(O))return!0;var T=Object.entries(R).find(([Ee,Zt])=>!sn.has(Ee));return T});if(s||t.$and||t.$or)return!1;var o=[],a=new Set;for(var[u,c]of Object.entries(t)){if(!e.includes(u))return!1;var l=Object.keys(c).filter(O=>fc.has(O));if(l.length>1)return!1;var f=l[0];if(f&&a.add(u),f!=="$eq"){if(o.length>0)return!1;o.push(f)}}var h=[],d=new Set;for(var[v,p]of Object.entries(t)){if(!e.includes(v))return!1;var g=Object.keys(p).filter(O=>hc.has(O));if(g.length>1)return!1;var b=g[0];if(b&&d.add(v),b!=="$eq"){if(h.length>0)return!1;h.push(b)}}var y=0;for(var w of e){for(var I of[a,d]){if(!I.has(w)&&I.size>0)return!1;I.delete(w)}var _=r[y],E=n[y];if(_!==E&&a.size>0&&d.size>0)return!1;y++}return!0}function mc(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function pc(e,t,r){var n=0,i=l=>{l>0&&(n=n+l)},s=10,o=tr(r.startKeys,l=>l!==re&&l!==te);i(o*s);var a=tr(r.startKeys,l=>l!==te&&l!==re);i(a*s);var u=tr(r.startKeys,(l,f)=>l===r.endKeys[f]);i(u*s*1.5);var c=r.sortSatisfiedByIndex?5:0;return i(c),n}class Ne extends Error{}const vc=2147483647,yc=-2147483648,gc=Number.MAX_SAFE_INTEGER,bc=Number.MIN_SAFE_INTEGER,ie=Symbol("missing"),ls=Object.freeze(new Error("mingo: cycle detected while processing object/array")),wc=Object.getPrototypeOf([]),fs=Object.getPrototypeOf({}),_c="[object Object]",Oc=/^\[object ([a-zA-Z0-9]+)\]$/;class on{}class an{}const Ae=e=>e===null?on:e===void 0?an:e.constructor,gt=e=>{const t=xc(e);let r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},hs=new Set(["null","undefined","boolean","number","string","date","regexp"]),$n=new Set([an,on,Boolean,String,Number]),tt=e=>e.toString(),V=e=>`${Ae(e).name}[${e.toString()}]`,Le=new Map([[Number,tt],[Boolean,tt],[RegExp,tt],[Function,tt],[Symbol,tt],[Date,e=>e.toISOString()],[String,JSON.stringify],[on,e=>"null"],[an,e=>"undefined"],[Int8Array,V],[Uint8Array,V],[Uint8ClampedArray,V],[Int16Array,V],[Uint16Array,V],[Int32Array,V],[Uint32Array,V],[Float32Array,V],[Float64Array,V]]);typeof BigInt<"u"&&Le.set(BigInt,e=>"0x"+e.toString(16));typeof BigInt64Array<"u"&&Le.set(BigInt64Array,V);typeof BigUint64Array<"u"&&Le.set(BigUint64Array,V);const Ec={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},F=(e,t)=>{e===ie&&(e=void 0),t===ie&&(t=void 0);const[r,n]=[e,t].map(i=>Ec[ht(i).toLowerCase()]);return r!==n?r-n:r===1||r===2||r===6?e<t?-1:e>t?1:0:oe(e,t)?0:e<t?-1:e>t?1:0};function P(e,t){if(!e)throw new Ne(t)}const Sc=e=>{const t=Object.getPrototypeOf(Ae(e));return t&&t.name==="TypedArray"},Ar=e=>{if($n.has(Ae(e)))return e;const t=new Set,r=n=>{if(t.has(n))throw ls;const i=Ae(n);if($n.has(i))return n;try{if(k(n))return t.add(n),n.map(r);if(D(n)){t.add(n);const s={};for(const o in n)s[o]=r(n[o]);return s}}finally{t.delete(n)}return i===Date||i===RegExp||Sc(n)?new i(n):n};return r(e)},ht=e=>Oc.exec(Object.prototype.toString.call(e))[1],lr=e=>typeof e=="boolean",se=e=>typeof e=="string",j=e=>!isNaN(e)&&typeof e=="number",k=Array.isArray,D=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===fs||t===null)&&_c===Object.prototype.toString.call(e)},Jt=e=>e===Object(e),Lr=e=>e instanceof Date,Tt=e=>e instanceof RegExp,bt=e=>typeof e=="function",N=e=>e==null,ze=(e,t)=>e.includes(t),ds=(e,t)=>!ze(e,t),Ge=(e,t=!0)=>!!e||t&&e==="",Ve=e=>N(e)||se(e)&&!e||e instanceof Array&&e.length===0||D(e)&&Object.keys(e).length===0,Nn=e=>e===ie,Ye=e=>e instanceof Array?e:[e],W=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),Cc=(e,t)=>D(e)&&D(t)||k(e)&&k(t);function Tr(e,t,r){if(r=r||{flatten:!1},Nn(e)||N(e))return t;if(Nn(t)||N(t))return e;if(!Cc(e,t)){if(r.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(r.skipValidation=!0,k(e)){const n=e,i=t;if(r.flatten){let s=0,o=0;for(;s<n.length&&o<i.length;)n[s]=Tr(n[s++],i[o++],r);for(;o<i.length;)n.push(t[o++])}else wt(n,i)}else for(const n in t)e[n]=Tr(e[n],t[n],r);return e}function $r(e,t=gt){const r=new Map;return e.forEach((n,i)=>{const s=ps(n,t);r.has(s)?r.get(s).some(o=>oe(e[o],n))||r.get(s).push(i):r.set(s,[i])}),r}function un(e,t=gt){if(e.some(a=>a.length==0))return[];if(e.length===1)return Array.from(e);const r=Ic(e.map((a,u)=>[u,a.length]),a=>a[1]),n=e[r[0][0]],i=$r(n,t),s=new Map,o=new Array;return i.forEach((a,u)=>{const c=a.map(d=>n[d]),l=c.map(d=>0),f=c.map(d=>[r[0][0],0]);let h=!1;for(let d=1;d<e.length;d++){const[v,p]=r[d],g=e[v];if(s.has(d)||s.set(d,$r(g)),s.get(d).has(u)){const b=s.get(d).get(u).map(y=>g[y]);h=c.map((y,w)=>b.some((I,_)=>{const E=l[w];return oe(y,I)&&(l[w]++,v<f[w][0]&&(f[w]=[v,s.get(d).get(u)[_]])),E<l[w]})).some(Boolean)}if(!h)return}h&&wt(o,l.map((d,v)=>d===e.length-1?[c[v],f[v]]:ie).filter(d=>d!==ie))}),o.sort((a,u)=>{const[c,[l,f]]=a,[h,[d,v]]=u,p=F(l,d);return p!==0?p:F(f,v)}).map(a=>a[0])}function ms(e,t=0){const r=new Array;function n(i,s){for(let o=0,a=i.length;o<a;o++)k(i[o])&&(s>0||s<0)?n(i[o],Math.max(-1,s-1)):r.push(i[o])}return n(e,t),r}const Rc=e=>{let[t,r]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],n=t;for(;!r.length&&t!==fs&&t!==wc;)n=t,r=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);const i={};return r.forEach(s=>i[s]=e[s]),[i,n]};function oe(e,t){const r=[[e,t]];for(;r.length>0;){if([e,t]=r.pop(),e===t)continue;const n=Ae(e);if(n!==Ae(t)||bt(e))return!1;if(Le.has(n)){const i=Le.get(n);if(i(e)!==i(t))return!1;continue}if(n===Array||n===Object){const i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length||new Set(i.concat(s)).size!=i.length)return!1;for(const o of i)r.push([e[o],t[o]]);continue}return!1}return!r.length}function Dc(e,t=gt){const r=e.map(n=>ie);return $r(e,t).forEach((n,i)=>{n.forEach(s=>r[s]=e[s])}),r.filter(n=>n!==ie)}function xc(e){const t=new Set,r=n=>{const i=Ae(n);if(Le.has(i))return Le.get(i)(n);const s=i===Object?"":i.name;if(bt(n.toJSON))return`${s}(${JSON.stringify(n)})`;if(t.has(n))throw ls;t.add(n);try{if(i===Array)return"["+n.map(r).join(",")+"]";if(i!==Object){const[a,u]=Rc(n);if(k(n))return`${s}${r([...n,a])}`;n=a}const o=Object.keys(n);return o.sort(),`${s}{`+o.map(a=>`${a}:${r(n[a])}`).join(",")+"}"}finally{t.delete(n)}};return r(e)}function ps(e,t){return t=t||gt,N(e)?null:t(e).toString()}function Ic(e,t,r=F){if(Ve(e))return e;const n=new Array,i=new Array;for(let s=0;s<e.length;s++){const o=e[s],a=t(o,s);N(a)?i.push(o):n.push([a,o])}return n.sort((s,o)=>r(s[0],o[0])),wt(i,n.map(s=>s[1]))}function Pc(e,t,r=gt){if(e.length<1)return new Map;const n=new Map,i=new Map;for(let s=0;s<e.length;s++){const o=e[s],a=t(o,s),u=ps(a,r);if(u===null)i.has(null)?i.get(null).push(o):i.set(null,[o]);else{const c=n.has(u)?n.get(u).find(l=>oe(l,a)):null;N(c)?(i.set(a,[o]),n.has(u)?n.get(u).push(a):n.set(u,[a])):i.get(c).push(o)}}return i}const fr=5e4;function wt(e,...t){return e instanceof Array?t.reduce((r,n)=>{let i=Math.ceil(n.length/fr),s=0;for(;i-- >0;)Array.prototype.push.apply(r,n.slice(s,s+fr)),s+=fr;return r},e):t.filter(Jt).reduce((r,n)=>(Object.assign(r,n),r),e)}function Nr(e,t){return Jt(e)?e[t]:void 0}function kc(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function Xe(e,t,r){let n=0;function i(o,a){let u=o;for(let c=0;c<a.length;c++){const l=a[c];if(/^\d+$/.exec(l)===null&&u instanceof Array){if(c===0&&n>0)break;n+=1;const h=a.slice(c);u=u.reduce((d,v)=>{const p=i(v,h);return p!==void 0&&d.push(p),d},[]);break}else u=Nr(u,l);if(u===void 0)break}return u}const s=hs.has(ht(e).toLowerCase())?e:i(e,t.split("."));return s instanceof Array&&(r!=null&&r.unwrapArray)?kc(s,n):s}function $t(e,t,r){const n=t.split("."),i=n[0],s=n.slice(1).join("."),o=/^\d+$/.exec(i)!==null,a=n.length>1;let u,c;if(e instanceof Array)if(o)u=Nr(e,Number(i)),a&&(u=$t(u,s,r)),u=[u];else{u=[];for(const l of e)c=$t(l,t,r),r!=null&&r.preserveMissing?(c===void 0&&(c=ie),u.push(c)):c!==void 0&&u.push(c)}else{if(c=Nr(e,i),a&&(c=$t(c,s,r)),c===void 0)return;u=r!=null&&r.preserveKeys?Object.assign({},e):{},u[i]=c}return u}function Br(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===ie?e.splice(t,1):Br(e[t]);else if(D(e))for(const t in e)W(e,t)&&Br(e[t])}const Bn=/^\d+$/;function dt(e,t,r,n){const i=t.split("."),s=i[0],o=i.slice(1).join(".");if(i.length===1)(D(e)||k(e)&&Bn.test(s))&&r(e,s);else{n!=null&&n.buildGraph&&N(e[s])&&(e[s]={});const a=e[s];if(!a)return;const u=!!(i.length>1&&Bn.test(i[1]));a instanceof Array&&(n!=null&&n.descendArray)&&!u?a.forEach(c=>dt(c,o,r,n)):dt(a,o,r,n)}}function Mc(e,t,r){dt(e,t,(n,i)=>{n[i]=bt(r)?r(n[i]):r},{buildGraph:!0})}function Fn(e,t,r){dt(e,t,(n,i)=>{if(n instanceof Array){if(/^\d+$/.test(i))n.splice(parseInt(i),1);else if(r&&r.descendArray)for(const s of n)D(s)&&delete s[i]}else D(n)&&delete n[i]},r)}const Ac=/^\$[a-zA-Z0-9_]+$/;function Be(e){return Ac.test(e)}function vs(e){if(hs.has(ht(e).toLowerCase()))return Tt(e)?{$regex:e}:{$eq:e};if(Jt(e)){if(!Object.keys(e).some(Be))return{$eq:e};if(W(e,"$regex")){const r=Object.assign({},e);return r.$regex=new RegExp(e.$regex,e.$options),delete r.$options,r}}return e}var me;(function(e){e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF"})(me||(me={}));class Ie{constructor(t,r,n,i=Date.now()){this._opts=t,this._root=r,this._local=n,this.timestamp=i,this.update(r,n)}static init(t,r,n){return t instanceof Ie?new Ie(t._opts,N(t.root)?r:t.root,Object.assign({},t.local,n)):new Ie(t,r,n)}update(t,r){var n;return this._root=t,this._local=r&&Object.assign({},r,{variables:Object.assign({},(n=this._local)===null||n===void 0?void 0:n.variables,r==null?void 0:r.variables)}),this}getOptions(){return Object.freeze(Object.assign(Object.assign({},this._opts),{context:Te.from(this._opts.context)}))}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){var t;return(t=this._opts)===null||t===void 0?void 0:t.collation}get processingMode(){var t;return((t=this._opts)===null||t===void 0?void 0:t.processingMode)||me.CLONE_OFF}get useStrictMode(){var t;return(t=this._opts)===null||t===void 0?void 0:t.useStrictMode}get scriptEnabled(){var t;return(t=this._opts)===null||t===void 0?void 0:t.scriptEnabled}get useGlobalContext(){var t;return(t=this._opts)===null||t===void 0?void 0:t.useGlobalContext}get hashFunction(){var t;return(t=this._opts)===null||t===void 0?void 0:t.hashFunction}get collectionResolver(){var t;return(t=this._opts)===null||t===void 0?void 0:t.collectionResolver}get jsonSchemaValidator(){var t;return(t=this._opts)===null||t===void 0?void 0:t.jsonSchemaValidator}get variables(){var t;return(t=this._opts)===null||t===void 0?void 0:t.variables}get context(){var t;return(t=this._opts)===null||t===void 0?void 0:t.context}}function qt(e){return e instanceof Ie?e.getOptions():Object.freeze(Object.assign(Object.assign({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:me.CLONE_OFF},e),{context:e!=null&&e.context?Te.from(e==null?void 0:e.context):Te.init({})}))}var S;(function(e){e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window"})(S||(S={}));class Te{constructor(t){this.operators={[S.ACCUMULATOR]:{},[S.EXPRESSION]:{},[S.PIPELINE]:{},[S.PROJECTION]:{},[S.QUERY]:{},[S.WINDOW]:{}};for(const[r,n]of Object.entries(t))this.addOperators(r,n)}static init(t={}){return new Te(t)}static from(t){return new Te(t.operators)}addOperators(t,r){for(const[n,i]of Object.entries(r))this.getOperator(t,n)||(this.operators[t][n]=i);return this}addAccumulatorOps(t){return this.addOperators(S.ACCUMULATOR,t)}addExpressionOps(t){return this.addOperators(S.EXPRESSION,t)}addQueryOps(t){return this.addOperators(S.QUERY,t)}addPipelineOps(t){return this.addOperators(S.PIPELINE,t)}addProjectionOps(t){return this.addOperators(S.PROJECTION,t)}addWindowOps(t){return this.addOperators(S.WINDOW,t)}getOperator(t,r){return t in this.operators&&this.operators[t][r]||null}}const Re=Te.init();function Un(e,t){for(const[r,n]of Object.entries(t)){P(bt(n)&&Be(r),`'${r}' is not a valid operator`);const i=Pe(e,r,null);P(!i||n===i,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case S.ACCUMULATOR:Re.addAccumulatorOps(t);break;case S.EXPRESSION:Re.addExpressionOps(t);break;case S.PIPELINE:Re.addPipelineOps(t);break;case S.PROJECTION:Re.addProjectionOps(t);break;case S.QUERY:Re.addQueryOps(t);break;case S.WINDOW:Re.addWindowOps(t);break}}function Pe(e,t,r){const{context:n,useGlobalContext:i}=r||{},s=n?n.getOperator(e,t):null;return!s&&i?Re.getOperator(e,t):s}const qn={$$ROOT(e,t,r){return r.root},$$CURRENT(e,t,r){return e},$$REMOVE(e,t,r){},$$NOW(e,t,r){return new Date(r.timestamp)}},Fr={$$KEEP(e,t,r){return e},$$PRUNE(e,t,r){},$$DESCEND(e,t,r){if(!W(t,"$cond"))return e;let n;for(const[i,s]of Object.entries(e))if(Jt(s)){if(s instanceof Array){const o=[];for(let a of s)D(a)&&(a=jn(a,t,r.update(a))),N(a)||o.push(a);n=o}else n=jn(s,t,r.update(s));N(n)?delete e[i]:e[i]=n}return e}};function $(e,t,r,n){var i;const s=Ie.init(n,e);if(r=r||"",Be(r)){const o=Pe(S.EXPRESSION,r,n);if(o)return o(e,t,s);const a=Pe(S.ACCUMULATOR,r,n);if(a)return e instanceof Array||(e=$(e,t,null,s),t=null),P(e instanceof Array,`'${r}' target must be an array.`),a(e,t,s.update(null,s.local));throw new Ne(`operator '${r}' is not registered`)}if(se(t)&&t.length>0&&t[0]==="$"){if(W(Fr,t))return t;let o=s.root;const a=t.split(".");if(W(qn,a[0]))o=qn[a[0]](e,null,s),t=t.slice(a[0].length+1);else if(a[0].slice(0,2)==="$$"){o=Object.assign({},s.variables,{this:e},(i=s.local)===null||i===void 0?void 0:i.variables);const u=a[0].slice(2);P(W(o,u),`Use of undefined variable: ${u}`),t=t.slice(2)}else t=t.slice(1);return t===""?o:Xe(o,t)}if(k(t))return t.map(o=>$(e,o,null,s));if(D(t)){const o={};for(const[a,u]of Object.entries(t))if(o[a]=$(e,u,a,s),[S.EXPRESSION,S.ACCUMULATOR].some(c=>!!Pe(c,a,n)))return P(Object.keys(t).length===1,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),o[a];return o}return t}function jn(e,t,r){const n=$(e,t,null,r);return W(Fr,n)?Fr[n](e,t,r):n}function Je(e){return e instanceof Wn?e:new Wn(e)}function Lc(...e){let t=0;return Je(()=>{for(;t<e.length;){const r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function Tc(e){return!!e&&typeof e=="object"&&(e==null?void 0:e.next)instanceof Function}function $c(e,t){const r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}const Ur=new Error;var ee;(function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"})(ee||(ee={}));function Nc(e,t,r){let n=!1,i=-1,s=0;return function(o){try{e:for(;!n;){let a=e();i++;let u=-1;const c=t.length;let l=!1;for(;++u<c;){const f=t[u];switch(f.action){case ee.MAP:a=f.func(a,i);break;case ee.FILTER:if(!f.func(a,i))continue e;break;case ee.TAKE:--f.count,f.count||(l=!0);break;case ee.DROP:--f.count,f.count||$c(t,u);continue e;default:break e}}if(n=l,o)r[s++]=a;else return{value:a,done:!1}}}catch(a){if(a!==Ur)throw a}return n=!0,{done:n}}}class Wn{constructor(t){this.iteratees=[],this.yieldedValues=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),Tc(t)){const n=t;r=()=>{const i=n.next();if(i.done)throw Ur;return i.value}}else if(t instanceof Array){const n=t,i=n.length;let s=0;r=()=>{if(s<i)return n[s++];throw Ur}}else if(!(t instanceof Function))throw new Ne("Lazy must be initialized with an array, generator, or function.");this.getNext=Nc(r,this.iteratees,this.yieldedValues)}push(t,r){return typeof r=="function"?this.iteratees.push({action:t,func:r}):typeof r=="number"&&this.iteratees.push({action:t,count:r}),this}next(){return this.getNext()}map(t){return this.push(ee.MAP,t)}filter(t){return this.push(ee.FILTER,t)}take(t){return t>0?this.push(ee.TAKE,t):this}drop(t){return t>0?this.push(ee.DROP,t):this}transform(t){const r=this;let n;return Je(()=>(n||(n=Je(t(r.value()))),n.next()))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(t){for(;;){const r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let n=this.next();for(r===void 0&&!n.done&&(r=n.value,n=this.next());!n.done;)r=t(r,n.value),n=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}}class Bc{constructor(t,r){this.pipeline=t,this.options=qt(r)}stream(t){let r=Je(t);const n=this.options.processingMode;(n==me.CLONE_ALL||n==me.CLONE_INPUT)&&r.map(Ar);const i=new Array;if(!Ve(this.pipeline))for(const s of this.pipeline){const o=Object.keys(s),a=o[0],u=Pe(S.PIPELINE,a,this.options);P(o.length===1&&!!u,`invalid pipeline operator ${a}`),i.push(a),r=u(r,s[a],this.options)}return(n==me.CLONE_OUTPUT||n==me.CLONE_ALL&&un([["$group","$unwind"],i]).length)&&r.map(Ar),r}run(t){return this.stream(t).value()}}class Fc{constructor(t,r,n,i){this.source=t,this.predicate=r,this.projection=n,this.options=i,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result?this.result:(D(this.projection)&&this.operators.push({$project:this.projection}),this.result=Je(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new Bc(this.operators,this.options).stream(this.result)),this.result)}fetchAll(){const t=Je([...this.buffer]);return this.buffer=[],Lc(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.operators.push({$skip:t}),this}limit(t){return this.operators.push({$limit:t}),this}sort(t){return this.operators.push({$sort:t}),this}collation(t){return this.options=Object.assign(Object.assign({},this.options),{collation:t}),this}next(){if(this.buffer.length>0)return this.buffer.pop();const t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.buffer.length>0)return!0;const t=this.fetch().next();return t.done?!1:(this.buffer.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}class ae{constructor(t,r){this.condition=t,this.options=qt(r),this.compiled=[],this.compile()}compile(){P(D(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);const t={};for(const[r,n]of Object.entries(this.condition)){if(r==="$where")Object.assign(t,{field:r,expr:n});else if(ze(["$and","$or","$nor","$expr","$jsonSchema"],r))this.processOperator(r,r,n);else{P(!Be(r),`unknown top level operator: ${r}`);for(const[i,s]of Object.entries(vs(n)))this.processOperator(r,i,s)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,n){const i=Pe(S.QUERY,r,this.options);if(!i)throw new Ne(`unknown query operator ${r}`);const s=i(t,n,this.options);this.compiled.push(s)}test(t){for(let r=0,n=this.compiled.length;r<n;r++)if(!this.compiled[r](t))return!1;return!0}find(t,r){return new Fc(t,n=>this.test(n),r||{},this.options)}remove(t){return t.reduce((r,n)=>(this.test(n)||r.push(n),r),[])}}const Uc=(e,t,r)=>{if(Ve(t)||!D(t))return e;let n=F;const i=r.collation;return D(i)&&se(i.locale)&&(n=jc(i)),e.transform(s=>{const o=Object.keys(t);for(const a of o.reverse()){const u=Pc(s,l=>Xe(l,a),r.hashFunction),c=Array.from(u.keys()).sort(n);t[a]===-1&&c.reverse(),s=[],c.reduce((l,f)=>wt(l,u.get(f)),s)}return s})},qc={1:"base",2:"accent",3:"variant"};function jc(e){const t={sensitivity:qc[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));const r=new Intl.Collator(e.locale,t);return(n,i)=>{if(!se(n)||!se(i))return F(n,i);const s=r.compare(n,i);return s<0?-1:s>0?1:0}}function B(e){const t=(r,n,i)=>{const s={unwrapArray:!0},o=Math.max(1,r.split(".").length-1);return a=>{const u=Xe(a,r,s);return e(u,n,Object.assign(Object.assign({},i),{depth:o}))}};return t.op="query",t}function Ze(e){return(t,r,n)=>{const i=$(t,r,null,n);return e(...i)}}function cn(e,t,r){if(oe(e,t)||N(e)&&N(t))return!0;if(e instanceof Array){const n=oe.bind(null,t);return e.some(n)||ms(e,r==null?void 0:r.depth).some(n)}return!1}function ys(e,t,r){return!cn(e,t,r)}function gs(e,t,r){return N(e)?t.some(n=>n===null):un([Ye(e),t],r==null?void 0:r.hashFunction).length>0}function Wc(e,t,r){return!gs(e,t,r)}function bs(e,t,r){return Vt(e,t,(n,i)=>F(n,i)<0)}function ws(e,t,r){return Vt(e,t,(n,i)=>F(n,i)<=0)}function _s(e,t,r){return Vt(e,t,(n,i)=>F(n,i)>0)}function Os(e,t,r){return Vt(e,t,(n,i)=>F(n,i)>=0)}function Hc(e,t,r){return Ye(e).some(n=>t.length===2&&n%t[0]===t[1])}function Kc(e,t,r){const n=Ye(e),i=s=>se(s)&&Ge(t.exec(s),r==null?void 0:r.useStrictMode);return n.some(i)||ms(n,1).some(i)}function Qc(e,t,r){return(t===!1||t===0)&&e===void 0||(t===!0||t===1)&&e!==void 0}function zc(e,t,r){if(!k(e)||!k(t)||!e.length||!t.length)return!1;let n=!0;for(const i of t){if(!n)break;D(i)&&ze(Object.keys(i),"$elemMatch")?n=Es(e,i.$elemMatch,r):i instanceof RegExp?n=e.some(s=>typeof s=="string"&&i.test(s)):n=e.some(s=>oe(i,s))}return n}function Gc(e,t,r){return Array.isArray(e)&&e.length===t}function Jc(e){return Be(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Es(e,t,r){if(k(e)&&!Ve(e)){let n=o=>o,i=t;Object.keys(t).every(Jc)&&(i={temp:t},n=o=>({temp:o}));const s=new ae(i,r);for(let o=0,a=e.length;o<a;o++)if(s.test(n(e[o])))return!0}return!1}const Hn=e=>e===null,Kn=e=>j(e)&&e>=yc&&e<=vc&&e.toString().indexOf(".")===-1,Qn=e=>j(e)&&e>=bc&&e<=gc&&e.toString().indexOf(".")===-1,Vc={array:k,bool:lr,boolean:lr,date:Lr,decimal:j,double:j,int:Kn,long:Qn,number:j,null:Hn,object:D,regex:Tt,regexp:Tt,string:se,undefined:N,function:e=>{throw new Ne("unsupported type key `function`.")},1:j,2:se,3:D,4:k,6:N,8:lr,9:Lr,10:Hn,11:Tt,16:Kn,18:Qn,19:j};function zn(e,t,r){const n=Vc[t];return n?n(e):!1}function Yc(e,t,r){return Array.isArray(t)?t.findIndex(n=>zn(e,n))>=0:zn(e,t)}function Vt(e,t,r){return Ye(e).some(n=>ht(n)===ht(t)&&r(n,t))}const Xc=(e,t,r)=>{const n=$(e,t,null,r);return Ge(n,r.useStrictMode)&&n.every(i=>Ge(i,r.useStrictMode))},Zc=(e,t,r)=>{const n=Ye(t);if(n.length==0)return!1;if(n.length==1)return!$(e,n[0],null,r);throw"Expression $not takes exactly 1 argument"},el=(e,t,r)=>{const n=$(e,t,null,r),i=r.useStrictMode;return Ge(n,i)&&n.some(s=>Ge(s,i))},tl=Object.freeze(Object.defineProperty({__proto__:null,$and:Xc,$not:Zc,$or:el},Symbol.toStringTag,{value:"Module"})),rl=(e,t,r)=>{const n=$(e,t,null,r);return n[0]>n[1]?1:n[0]<n[1]?-1:0},nl=Ze(cn),il=Ze(_s),sl=Ze(Os),ol=Ze(bs),al=Ze(ws),ul=Ze(ys),cl=Object.freeze(Object.defineProperty({__proto__:null,$cmp:rl,$eq:nl,$gt:il,$gte:sl,$lt:ol,$lte:al,$ne:ul},Symbol.toStringTag,{value:"Module"})),Gn=(e,t)=>{const r={};return e.split("").forEach((n,i)=>r[n]=t*(i+1)),r};Object.assign(Object.assign(Object.assign({},Gn("ABCDEFGHIKLM",1)),Gn("NOPQRSTUVWXY",-1)),{Z:0});const Jn={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function H(e,t=Jn){const r=Object.assign({},Jn,t),n=new Set(Object.keys(r));return(i,s,o)=>{const a=$(i,s,null,o);if(n.has(`${a}`)){const u=r[`${a}`];if(u instanceof Error)throw new Ne(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return u}return e(a)}}H(Math.acos,{Infinity:1/0,0:new Error});H(Math.acosh,{Infinity:1/0,0:new Error});H(Math.asin);H(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});H(Math.atan);H(Math.atanh,{1:1/0,"-1":-1/0});H(Math.cos);H(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const ll=Math.PI/180;H(e=>e*ll,{Infinity:1/0,"-Infinity":1/0});const fl=180/Math.PI;H(e=>e*fl,{Infinity:1/0,"-Infinity":-1/0});H(Math.sin);H(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});H(Math.tan);const hl=(e,t,r)=>{if(Ve(t))return e;let n=Object.keys(t),i=!1;Ss(t,r);const s=r.idKey;if(ze(n,s)){const a=t[s];(a===0||a===!1)&&(n=n.filter(ds.bind(null,[s])),i=n.length==0)}else n.push(s);const o=Ie.init(r);return e.map(a=>qr(a,t,o.update(a),n,i))};function qr(e,t,r,n,i){let s={},o=!1,a=!1;const u=[];i&&u.push(r.idKey);for(const c of n){let l;const f=t[c];if(c!==r.idKey&&ze([0,!1],f)&&(a=!0),c===r.idKey&&Ve(f))l=e[c];else if(se(f))l=$(e,f,c,r);else if(!ze([1,!0],f))if(f instanceof Array)l=f.map(d=>{const v=$(e,d,null,r);return N(v)?null:v});else if(D(f)){const d=f,v=Object.keys(f),p=v.length==1?v[0]:"",g=Pe(S.PROJECTION,p,r);if(g)p==="$slice"?Ye(d[p]).every(j)?(l=g(e,d[p],c,r),o=!0):l=$(e,d,c,r):l=g(e,d[p],c,r);else if(Be(p))l=$(e,d[p],p,r);else if(W(e,c)){Ss(d,r);let b=e[c];b instanceof Array?l=b.map(y=>qr(y,d,r,v,!1)):(b=D(b)?b:e,l=qr(b,d,r,v,!1))}else l=$(e,f,null,r)}else{u.push(c);continue}const h=$t(e,c,{preserveMissing:!0});h!==void 0&&Tr(s,h,{flatten:!0}),ds([0,1,!1,!0],f)&&(l===void 0?Fn(s,c,{descendArray:!0}):Mc(s,c,l))}if(Br(s),(o||a||i)&&(s=wt({},e,s),u.length>0))for(const c of u)Fn(s,c,{descendArray:!0});return s}function Ss(e,t){const r=[!1,!1];for(const[n,i]of Object.entries(e)){if(n===(t==null?void 0:t.idKey))return;i===0||i===!1?r[0]=!0:(i===1||i===!0)&&(r[1]=!0),P(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const Cs=(e,t,r)=>{P(k(t),"Invalid expression: $and expects value to be an Array.");const n=t.map(i=>new ae(i,r));return i=>n.every(s=>s.test(i))},ln=(e,t,r)=>{P(k(t),"Invalid expression. $or expects value to be an Array");const n=t.map(i=>new ae(i,r));return i=>n.some(s=>s.test(i))},Rs=(e,t,r)=>{P(k(t),"Invalid expression. $nor expects value to be an array.");const n=ln("$or",t,r);return i=>!n(i)},Ds=(e,t,r)=>{const n={};n[e]=vs(t);const i=new ae(n,r);return s=>!i.test(s)},xs=B(cn),Is=B(_s),Ps=B(Os),ks=B(gs),Ms=B(bs),As=B(ws),Ls=B(ys),Ts=B(Wc);function dl(e,t,r){return n=>$(n,t,null,r)}function ml(e,t,r){if(!(r!=null&&r.jsonSchemaValidator))throw new Ne("Missing option 'jsonSchemaValidator'. Configure to use '$jsonSchema' operator.");const n=r==null?void 0:r.jsonSchemaValidator(t);return i=>n(i)}const $s=B(Hc),Ns=B(Kc);function pl(e,t,r){P(r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true");const n=t;return P(bt(n),"$where only accepts a Function object"),i=>Ge(n.call(i),r==null?void 0:r.useStrictMode)}const vl=B(zc),Bs=B(Es),Fs=B(Gc),Us=B(Qc),qs=B(Yc);var Vn=!1;function yl(e){return Vn||(Un(S.PIPELINE,{$sort:Uc,$project:hl}),Un(S.QUERY,{$and:Cs,$eq:xs,$elemMatch:Bs,$exists:Us,$gt:Is,$gte:Ps,$in:ks,$lt:Ms,$lte:As,$ne:Ls,$nin:Ts,$mod:$s,$nor:Rs,$not:Ds,$or:ln,$regex:Ns,$size:Fs,$type:qs}),Vn=!0),new ae(e)}function jr(e,t){var r=ce(e.primaryKey);t=L(t);var n=je(t);if(typeof n.skip!="number"&&(n.skip=0),n.selector?(n.selector=n.selector,Object.entries(n.selector).forEach(([c,l])=>{(typeof l!="object"||l===null)&&(n.selector[c]={$eq:l})})):n.selector={},n.index){var i=gi(n.index);i.includes(r)||i.push(r),n.index=i}if(n.sort){var u=n.sort.find(c=>Zo(c)===r);u||(n.sort=n.sort.slice(0),n.sort.push({[r]:"asc"}))}else if(n.index)n.sort=n.index.map(c=>({[c]:"asc"}));else{if(e.indexes){var s=new Set;Object.entries(n.selector).forEach(([c,l])=>{var f=!1;typeof l=="object"&&l!==null?f=!!Object.keys(l).find(h=>sn.has(h)):f=!0,f&&s.add(c)});var o=-1,a;e.indexes.forEach(c=>{var l=Ue(c)?c:[c],f=l.findIndex(h=>!s.has(h));f>0&&f>o&&(o=f,a=l)}),a&&(n.sort=a.map(c=>({[c]:"asc"})))}n.sort||(n.sort=[{[r]:"asc"}])}return n}function js(e,t){if(!t.sort)throw m("SNH",{query:t});var r=[];t.sort.forEach(i=>{var s=Object.keys(i)[0],o=Object.values(i)[0];r.push({key:s,direction:o,getValueFn:wi(s)})});var n=(i,s)=>{for(var o=0;o<r.length;++o){var a=r[o],u=a.getValueFn(i),c=a.getValueFn(s);if(u!==c){var l=a.direction==="asc"?F(u,c):F(c,u);return l}}};return n}function fn(e,t){if(!t.sort)throw m("SNH",{query:t});var r=yl(t.selector),n=i=>r.test(i);return n}function gl(e,t){return!t.sort||t.sort.length===0?[e]:t.sort.map(r=>Object.keys(r)[0])}var bl=new WeakMap;function wl(e){return be(bl,e,()=>{var t=e.collection,r=jr(t.storageInstance.schema,je(e.mangoQuery)),n=t.schema.primaryPath,i=js(t.schema.jsonSchema,r),s=(c,l)=>{var f={docA:c,docB:l,rxQuery:e};return i(f.docA,f.docB)},o=fn(t.schema.jsonSchema,r),a=c=>{var l={doc:c,rxQuery:e};return o(l.doc)},u={primaryKey:e.collection.schema.primaryPath,skip:r.skip,limit:r.limit,sortFields:gl(n,r),sortComparator:s,queryMatcher:a};return u})}function _l(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};var r=wl(e),n=x(e._result).docsData.slice(0),i=x(e._result).docsDataMap,s=!1,o=t.map(u=>wu(u)).filter(Xo),a=o.find(u=>{var c={queryParams:r,changeEvent:u,previousResults:n,keyDocumentMap:i},l=uc(c);if(l==="runFullQueryAgain")return!0;if(l!=="doNothing")return s=!0,cc(l,r,u,n,i),!1});return a?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:s,newResults:n}}var Ol=function(){function e(){this._map=new Map}var t=e.prototype;return t.getByQuery=function(n){var i=n.toString();return be(this._map,i,()=>n)},e}();function El(){return new Ol}function Yn(e,t){t.uncached=!0;var r=t.toString();e._map.delete(r)}function Sl(e){return e.refCount$.observers.length}var Cl=100,Rl=30*1e3,Dl=(e,t)=>(r,n)=>{if(!(n._map.size<e)){var i=Q()-t,s=[],o=Array.from(n._map.values());for(var a of o)if(!(Sl(a)>0)){if(a._lastEnsureEqual===0&&a._creationTime<i){Yn(n,a);continue}s.push(a)}var u=s.length-e;if(!(u<=0)){var c=s.sort((f,h)=>f._lastEnsureEqual-h._lastEnsureEqual),l=c.slice(0,u);l.forEach(f=>Yn(n,f))}}},Ws=Dl(Cl,Rl),hr=new WeakSet;function xl(e){hr.has(e)||(hr.add(e),ma().then(()=>ya(200)).then(()=>{e.destroyed||e.cacheReplacementPolicy(e,e._queryCache),hr.delete(e)}))}var Il=function(){function e(r,n,i){this.cacheItemByDocId=new Map,this.registry=typeof FinalizationRegistry=="function"?new FinalizationRegistry(s=>{var o=s.docId,a=this.cacheItemByDocId.get(o);a&&(a.byRev.delete(s.revisionHeight),a.byRev.size===0&&this.cacheItemByDocId.delete(o))}):void 0,this.registerIdleTasks=[],this.primaryPath=r,this.changes$=n,this.documentCreator=i,n.subscribe(s=>{var o=s.documentId,a=this.cacheItemByDocId.get(o);if(a){var u=ss(s);a.last=u}})}var t=e.prototype;return t.getLatestDocumentData=function(n){var i=ct(this.cacheItemByDocId,n);return i.last},t.getLatestDocumentDataIfExists=function(n){var i=this.cacheItemByDocId.get(n);if(i)return i.last},we(e,[{key:"getCachedRxDocument",get:function(){var r=Pl(this);return pe(this,"getCachedRxDocument",r)}}])}();function Pl(e){var t=e.primaryPath,r=e.cacheItemByDocId,n=e.registry,i=M.deepFreezeWhenDevMode,s=e.documentCreator,o=a=>{var u=a[t],c=Rn(a._rev),l=be(r,u,()=>kl(a)),f=l.byRev,h=f.get(c),d=h?h.deref():void 0;return d||(a=i(a),d=s(a),f.set(c,Al(d)),n&&(e.registerIdleTasks.push(d),e.registerIdlePromise||(e.registerIdlePromise=Qr().then(()=>{e.registerIdlePromise=void 0;var v=e.registerIdleTasks;v.length!==0&&(e.registerIdleTasks=[],v.forEach(p=>{n.register(p,{docId:p.primary,revisionHeight:Rn(p.revision)})}))})))),d};return o}function Hs(e,t){for(var r=e.getCachedRxDocument,n=[],i=0;i<t.length;i++){var s=t[i],o=r(s);n.push(o)}return n}function kl(e){return{byRev:new Map,last:e}}var Ml=typeof WeakRef=="function",Al=Ml?Ll:Tl;function Ll(e){return new WeakRef(e)}function Tl(e){return{deref(){return e}}}var Xn=function(){function e(t,r,n){this.time=Q(),this.collection=t,this.count=n,this.documents=Hs(this.collection._docCache,r)}return we(e,[{key:"docsData",get:function(){return pe(this,"docsData",this.documents.map(t=>t._data))}},{key:"docsDataMap",get:function(){var t=new Map;return this.documents.forEach(r=>{t.set(r.primary,r._data)}),pe(this,"docsDataMap",t)}},{key:"docsMap",get:function(){for(var t=new Map,r=this.documents,n=0;n<r.length;n++){var i=r[n];t.set(i.primary,i)}return pe(this,"docsMap",t)}}])}(),$l=0,Nl=function(){return++$l},Ks=function(){function e(r,n,i,s={}){this.id=Nl(),this._execOverDatabaseCount=0,this._creationTime=Q(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new yu(null),this._result=null,this._latestChangeEvent=-1,this._lastExecStart=0,this._lastExecEnd=0,this._ensureEqualQueue=le,this.op=r,this.mangoQuery=n,this.collection=i,this.other=s,n||(this.mangoQuery=rt()),this.isFindOneByIdQuery=Ul(this.collection.schema.primaryPath,n)}var t=e.prototype;return t._setResultData=function(n){if(typeof n=="number"){this._result=new Xn(this.collection,[],n);return}else n instanceof Map&&(n=Array.from(n.values()));var i=new Xn(this.collection,n,n.length);this._result=i},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this._lastExecStart=Q(),this.op==="count"){var n=this.getPreparedQuery(),i=await this.collection.storageInstance.count(n);if(i.mode==="slow"&&!this.collection.database.allowSlowCount)throw m("QU14",{collection:this.collection,queryObj:this.mangoQuery});return i.count}if(this.op==="findByIds"){var s=x(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,o=new Map,a=[];if(s.forEach(l=>{var f=this.collection._docCache.getLatestDocumentDataIfExists(l);if(f){if(!f._deleted){var h=this.collection._docCache.getCachedRxDocument(f);o.set(l,h)}}else a.push(l)}),a.length>0){var u=await this.collection.storageInstance.findDocumentsById(a,!1);u.forEach(l=>{var f=this.collection._docCache.getCachedRxDocument(l);o.set(f.primary,f)})}return o}var c=zs(this);return c.then(l=>(this._lastExecEnd=Q(),l))},t.exec=function(n){if(n&&this.op!=="findOne")throw m("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return Zn(this).then(()=>_u(this.$)).then(i=>{if(!i&&n)throw m("QU10",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return i})},t.toString=function(){var n=Nt({op:this.op,query:this.mangoQuery,other:this.other},!0),i=JSON.stringify(n);return this.toString=()=>i,i},t.getPreparedQuery=function(){var n={rxQuery:this,mangoQuery:jr(this.collection.schema.jsonSchema,this.mangoQuery)};n.mangoQuery.selector._deleted={$eq:!1},n.mangoQuery.index&&n.mangoQuery.index.unshift("_deleted"),X("prePrepareQuery",n);var i=hn(this.collection.schema.jsonSchema,n.mangoQuery);return this.getPreparedQuery=()=>i,i},t.doesDocumentDataMatch=function(n){return n._deleted?!1:this.queryMatcher(n)},t.remove=function(){return this.exec().then(n=>Array.isArray(n)?Promise.all(n.map(i=>i.remove())):n.remove())},t.update=function(n){throw C("update")},t.where=function(n){throw C("query-builder")},t.sort=function(n){throw C("query-builder")},t.skip=function(n){throw C("query-builder")},t.limit=function(n){throw C("query-builder")},we(e,[{key:"$",get:function(){if(!this._$){var r=this.collection.$.pipe(Y(n=>!n.isLocal),is(null),yt(()=>Zn(this)),de(()=>this._result),ns(Si),Mr((n,i)=>!!(n&&n.time===x(i).time)),Y(n=>!!n),de(n=>{var i=x(n);return this.op==="count"?i.count:this.op==="findOne"?i.documents.length===0?null:i.documents[0]:this.op==="findByIds"?i.docsMap:i.documents.slice(0)}));this._$=Ou(r,this.refCount$.pipe(Y(()=>!1)))}return this._$}},{key:"$$",get:function(){var r=this.collection.database.getReactivityFactory();return r.fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){var r=this.collection.schema.jsonSchema,n=jr(this.collection.schema.jsonSchema,this.mangoQuery);return pe(this,"queryMatcher",fn(r,n))}},{key:"asRxQuery",get:function(){return this}}])}();function rt(){return{selector:{}}}function Bl(e){return e.collection._queryCache.getByQuery(e)}function Fe(e,t,r,n){X("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:n});var i=new Ks(e,t,r,n);return i=Bl(i),xl(r),i}function Qs(e){var t=e.asRxQuery.collection._changeEventBuffer.counter;return e._latestChangeEvent>=t}function Zn(e){return e.collection.database.destroyed||Qs(e)?le:(e._ensureEqualQueue=e._ensureEqualQueue.then(()=>Fl(e)),e._ensureEqualQueue)}function Fl(e){if(e._lastEnsureEqual=Q(),e.collection.database.destroyed||Qs(e))return le;var t=!1,r=!1;if(e._latestChangeEvent===-1&&(r=!0),!r){var n=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(n===null)r=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.counter;var i=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(n);if(e.op==="count"){var s=x(e._result).count,o=s;i.forEach(u=>{var c=u.previousDocumentData&&e.doesDocumentDataMatch(u.previousDocumentData),l=e.doesDocumentDataMatch(u.documentData);!c&&l&&o++,c&&!l&&o--}),o!==s&&(t=!0,e._setResultData(o))}else{var a=_l(e,i);a.runFullQueryAgain?r=!0:a.changed&&(t=!0,e._setResultData(a.newResults))}}}return r?e._execOverDatabase().then(u=>(e._latestChangeEvent=e.collection._changeEventBuffer.counter,typeof u=="number"?((!e._result||u!==e._result.count)&&(t=!0,e._setResultData(u)),t):((!e._result||!ta(e.collection.schema.primaryPath,u,e._result.docsData))&&(t=!0,e._setResultData(u)),t))):Promise.resolve(t)}function hn(e,t){if(!t.sort)throw m("SNH",{query:t});var r=lc(e,t);return{query:t,queryPlan:r}}async function zs(e){var t=[],r=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var n=e.isFindOneByIdQuery;if(n=n.filter(l=>{var f=e.collection._docCache.getLatestDocumentDataIfExists(l);return f?(f._deleted||t.push(f),!1):!0}),n.length>0){var i=await r.storageInstance.findDocumentsById(n,!1);at(t,i)}}else{var s=e.isFindOneByIdQuery,o=e.collection._docCache.getLatestDocumentDataIfExists(s);if(!o){var a=await r.storageInstance.findDocumentsById([s],!1);a[0]&&(o=a[0])}o&&!o._deleted&&t.push(o)}else{var u=e.getPreparedQuery(),c=await r.storageInstance.query(u);t=c.documents}return t}function Ul(e,t){if(!t.skip&&t.selector&&Object.keys(t.selector).length===1&&t.selector[e]){var r=t.selector[e];if(typeof r=="string")return r;if(Object.keys(r).length===1&&typeof r.$eq=="string"||Object.keys(r).length===1&&Array.isArray(r.$eq)&&!r.$eq.find(n=>typeof n!="string"))return r.$eq}return!1}var ql="_rxdb_internal";async function jl(e,t){var r=await e.findDocumentsById([t],!1),n=r[0];if(n)return n}function Wl(e,t,r){var n=t.documentData,i=t.previousDocumentData,s={documentId:t.documentId,collectionName:r?r.name:void 0,isLocal:e,operation:t.operation,documentData:M.deepFreezeWhenDevMode(n),previousDocumentData:M.deepFreezeWhenDevMode(i)};return s}function jt(e,t,r,n){if(n)throw n.status===409?m("CONFLICT",{collection:e.name,id:t,writeError:n,data:r}):n.status===422?m("VD2",{collection:e.name,id:t,writeError:n,data:r}):n}function Hl(e,t,r,n,i,s,o){for(var a=!!e.schema.attachments,u=[],c=[],l=[],f=pt(10),h={id:f,events:[],checkpoint:null,context:i,startTime:Q(),endTime:0},d=h.events,v=[],p=[],g=[],b=r.size>0,y,w=n.length,I=function(){var E=n[_],O=E.document,R=E.previous,T=O[t],Ee=O._deleted,Zt=R&&R._deleted,et=void 0;b&&(et=r.get(T));var Se;if(et){var Bo=et._rev;if(!R||R&&Bo!==R._rev){var Fo={isError:!0,status:409,documentId:T,writeRow:E,documentInDb:et};return l.push(Fo),1}var Rt=a?dr(E):E;a&&(Ee?R&&Object.keys(R._attachments).forEach(q=>{p.push({documentId:T,attachmentId:q,digest:x(R)._attachments[q].digest})}):(Object.entries(O._attachments).find(([q,J])=>{var It=R?R._attachments[q]:void 0;return!It&&!J.data&&(Se={documentId:T,documentInDb:et,isError:!0,status:510,writeRow:E,attachmentId:q}),!0}),Se||Object.entries(O._attachments).forEach(([q,J])=>{var It=R?R._attachments[q]:void 0;if(!It)v.push({documentId:T,attachmentId:q,attachmentData:J,digest:J.digest});else{var qo=Rt.document._attachments[q].digest;J.data&&It.digest!==qo&&g.push({documentId:T,attachmentId:q,attachmentData:J,digest:J.digest})}}))),Se?l.push(Se):(a?(c.push(dr(Rt)),o&&o(O)):(c.push(Rt),o&&o(O)),y=Rt);var Dt=null,er=null,xt=null;if(Zt&&!Ee)xt="INSERT",Dt=a?De(O):O;else if(R&&!Zt&&!Ee)xt="UPDATE",Dt=a?De(O):O,er=R;else if(Ee)xt="DELETE",Dt=x(O),er=R;else throw m("SNH",{args:{writeRow:E}});var Uo={documentId:T,documentData:Dt,previousDocumentData:er,operation:xt};d.push(Uo)}else{var $o=!!Ee;if(a&&Object.entries(O._attachments).forEach(([q,J])=>{J.data?v.push({documentId:T,attachmentId:q,attachmentData:J,digest:J.digest}):(Se={documentId:T,isError:!0,status:510,writeRow:E,attachmentId:q},l.push(Se))}),Se||(a?(u.push(dr(E)),s&&s(O)):(u.push(E),s&&s(O)),y=E),!$o){var No={documentId:T,operation:"INSERT",documentData:a?De(O):O,previousDocumentData:a&&R?De(R):R};d.push(No)}}},_=0;_<w;_++)I();return{bulkInsertDocs:u,bulkUpdateDocs:c,newestRow:y,errors:l,eventBulk:h,attachmentsAdd:v,attachmentsRemove:p,attachmentsUpdate:g}}function dr(e){return{previous:e.previous,document:De(e.document)}}function Kl(e){return atob(e).length}function Ql(e){var t=e.data;if(!t)return e;var r={length:Kl(t),digest:e.digest,type:e.type};return r}function De(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=L(e);return t._attachments={},Object.entries(e._attachments).forEach(([r,n])=>{t._attachments[r]=Ql(n)}),t}function Gs(e){var t=L(e);return t._meta=L(e._meta),t}function Js(e,t,r){M.deepFreezeWhenDevMode(r);var n=ce(r.primaryKey);function i(o){var a=L(o.document);if(a._meta=L(a._meta),M.isDevMode()){a=Pi(n,r,a);try{typeof structuredClone=="function"?structuredClone(o):JSON.parse(JSON.stringify(o))}catch{throw m("DOC24",{collection:t.collectionName,document:o.document})}o.previous,o.previous&&Object.keys(o.previous._meta).forEach(u=>{if(!Object.prototype.hasOwnProperty.call(o.document._meta,u))throw m("SNH",{dataBefore:o.previous,dataAfter:o.document})})}return a._meta.lwt=Q(),a._rev=Rr(e.token,o.previous),{document:a,previous:o.previous}}var s={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,bulkWrite(o,a){var u=o.map(c=>i(c));return e.lockedRun(()=>t.bulkWrite(u,a)).then(c=>{var l={error:[],success:c.success.slice(0)},f=c.error.filter(d=>d.status===409&&!d.writeRow.previous&&!d.writeRow.document._deleted&&x(d.documentInDb)._deleted?!0:(l.error.push(d),!1));if(f.length>0){var h=f.map(d=>({previous:d.documentInDb,document:Object.assign({},d.writeRow.document,{_rev:Rr(e.token,d.documentInDb)})}));return e.lockedRun(()=>t.bulkWrite(h,a)).then(d=>(at(l.error,d.error),at(l.success,d.success),l))}return c})},query(o){return e.lockedRun(()=>t.query(o))},count(o){return e.lockedRun(()=>t.count(o))},findDocumentsById(o,a){return e.lockedRun(()=>t.findDocumentsById(o,a))},getAttachmentData(o,a,u){return e.lockedRun(()=>t.getAttachmentData(o,a,u))},getChangedDocumentsSince:t.getChangedDocumentsSince?(o,a)=>e.lockedRun(()=>t.getChangedDocumentsSince(x(o),a)):void 0,cleanup(o){return e.lockedRun(()=>t.cleanup(o))},remove(){return e.storageInstances.delete(s),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(s),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()},conflictResultionTasks(){return t.conflictResultionTasks()},resolveConflictResultionTask(o){if(o.output.isEqual)return t.resolveConflictResultionTask(o);var a=Object.assign({},o.output.documentData,{_meta:zt(),_rev:mt(),_attachments:{}}),u=L(a);return delete u._meta,delete u._rev,delete u._attachments,t.resolveConflictResultionTask({id:o.id,output:{isEqual:!1,documentData:u}})}};return e.storageInstances.add(s),s}function zl(e){if(e.schema.keyCompression)throw m("UT5",{args:{params:e}});if(Gl(e.schema))throw m("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw m("UT7",{args:{params:e}})}function Gl(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}var Jl=function(){function e(r,n,i,s){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=r,this.primaryPath=n,this.preWrite=i,this.postWrite=s}var t=e.prototype;return t.addWrite=function(n,i){var s=n[this.primaryPath],o=be(this.queueByDocId,s,()=>[]),a=new Promise((u,c)=>{var l={lastKnownDocumentState:n,modifier:i,resolve:u,reject:c};x(o).push(l),this.triggerRun()});return a},t.triggerRun=async function(){if(!(this.isRunning===!0||this.queueByDocId.size===0)){this.isRunning=!0;var n=[],i=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(i.entries()).map(async([o,a])=>{var u=Vl(a.map(f=>f.lastKnownDocumentState)),c=u;for(var l of a)try{c=await l.modifier(je(c))}catch(f){l.reject(f),l.reject=()=>{},l.resolve=()=>{}}try{await this.preWrite(c,u)}catch(f){a.forEach(h=>h.reject(f));return}n.push({previous:u,document:c})}));var s=n.length>0?await this.storageInstance.bulkWrite(n,"incremental-write"):{error:[],success:[]};return await Promise.all(s.success.map(o=>{var a=o[this.primaryPath];this.postWrite(o);var u=ct(i,a);u.forEach(c=>c.resolve(o))})),s.error.forEach(o=>{var a=o.documentId,u=ct(i,a),c=Ii(o);if(c){var l=be(this.queueByDocId,a,()=>[]);u.reverse().forEach(h=>{h.lastKnownDocumentState=x(c.documentInDb),x(l).unshift(h)})}else{var f=Pa(o);u.forEach(h=>h.reject(f))}}),this.isRunning=!1,this.triggerRun()}},e}();function ei(e){var t=async r=>{var n=ea(r);n._deleted=r._deleted;var i=await e(n),s=Object.assign({},i,{_meta:r._meta,_attachments:r._attachments,_rev:r._rev,_deleted:typeof i._deleted<"u"?i._deleted:r._deleted});return typeof s._deleted>"u"&&(s._deleted=!1),s};return t}function Vl(e){var t=e[0],r=Cr(t._rev).height;return e.forEach(n=>{var i=Cr(n._rev).height;i>r&&(t=n,r=i)}),t}var _t={get primaryPath(){var e=this;if(e.isInstanceOfRxDocument)return e.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){var e=this;if(e.isInstanceOfRxDocument)return e._data._rev},get deleted$(){var e=this;if(e.isInstanceOfRxDocument)return e.$.pipe(de(t=>t._data._deleted))},get deleted$$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){var e=this;if(e.isInstanceOfRxDocument)return e._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this;return e.collection.$.pipe(Y(t=>!t.isLocal),Y(t=>t.documentId===this.primary),de(t=>ss(t)),is(e.collection._docCache.getLatestDocumentData(this.primary)),Mr((t,r)=>t._rev===r._rev),de(t=>this.collection._docCache.getCachedRxDocument(t)),ns(Si))},get $$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(e){if(M.isDevMode()){if(e.includes(".item."))throw m("DOC1",{path:e});if(e===this.primaryPath)throw m("DOC2");if(this.collection.schema.finalFields.includes(e))throw m("DOC3",{path:e});var t=Z(this.collection.schema.jsonSchema,e);if(!t)throw m("DOC4",{path:e})}return this.$.pipe(de(r=>he(r,e)),Mr())},get$$(e){var t=this.get$(e),r=this.collection.database.getReactivityFactory();return r.fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=Z(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return va;if(!t)throw m("DOC5",{path:e});if(!t.ref)throw m("DOC6",{path:e,schemaObj:t});var n=this.collection.database.collections[t.ref];if(!n)throw m("DOC7",{ref:t.ref,path:e,schemaObj:t});return t.type==="array"?n.findByIds(r).exec().then(i=>{var s=i.values();return Array.from(s)}):n.findOne(r).exec()},get(e){return be(this._propertyCache,e,()=>{var t=he(this._data,e);if(typeof t!="object"||t===null||Array.isArray(t))return M.deepFreezeWhenDevMode(t);var r=this,n=new Proxy(L(t),{get(i,s){if(typeof s!="string")return i[s];var o=s.charAt(s.length-1);if(s.endsWith("$$")){var a=s.slice(0,-2);return r.get$$(fe(e+"."+a))}else if(o==="$"){var u=s.slice(0,-1);return r.get$(fe(e+"."+u))}else if(o==="_"){var c=s.slice(0,-1);return r.populate(fe(e+"."+c))}else return r.get(fe(e+"."+s))}});return n})},toJSON(e=!1){if(e)return M.deepFreezeWhenDevMode(this._data);var t=L(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,M.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return je(this.toJSON(e))},update(e){throw C("update")},incrementalUpdate(e){throw C("update")},updateCRDT(e){throw C("crdt")},putAttachment(){throw C("attachments")},getAttachment(){throw C("attachments")},allAttachments(){throw C("attachments")},get allAttachments$(){throw C("attachments")},async modify(e,t){var r=this._data,n=await ei(e)(r);return this._saveData(n,r)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,ei(e)).then(r=>this.collection._docCache.getCachedRxDocument(r))},patch(e){var t=this._data,r=je(t);return Object.entries(e).forEach(([n,i])=>{r[n]=i}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,n])=>{t[r]=n}),t))},async _saveData(e,t){if(e=L(e),this._data._deleted)throw m("DOC11",{id:this.primary,document:this});await Ys(this.collection,e,t);var r=await this.collection.storageInstance.bulkWrite([{previous:t,document:e}],"rx-document-save-data"),n=r.error[0];return jt(this.collection,this.primary,e,n),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(r.success[0])},remove(){var e=this.collection;if(this.deleted)return Promise.reject(m("DOC13",{document:this,id:this.primary}));var t=L(this._data),r;return e._runHooks("pre","remove",t,this).then(async()=>{t._deleted=!0;var n=await e.storageInstance.bulkWrite([{previous:this._data,document:t}],"rx-document-remove"),i=n.error[0];return jt(e,this.primary,t,i),n.success[0]}).then(n=>(r=n,this.collection._runHooks("post","remove",t,this))).then(()=>this.collection._docCache.getCachedRxDocument(r))},incrementalRemove(){return this.incrementalModify(async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e)).then(async e=>(await this.collection._runHooks("post","remove",e._data,e),e))},destroy(){throw m("DOC14")}};function Vs(e=_t){var t=function(n,i){this.collection=n,this._data=i,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function Yl(e,t,r){var n=new e(t,r);return X("createRxDocument",n),n}function Ys(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),M.isDevMode()&&e.schema.validateChange(r,t),e._runHooks("pre","save",t,r)}var nt="collection",dn="storage-token",Xl="rx-migration-status",Zl="RxInternalDocument",mn=ki({version:0,title:Zl,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[nt,dn,Xl,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function Wr(e,t){return zr(mn,{key:e,context:t})}async function Xs(e){var t=hn(e.schema,{selector:{context:nt,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0}),r=await e.query(t),n=r.documents;return n}var Zs="storageToken",ef=Wr(Zs,dn);async function tf(e){var t=pt(10),r=e.password?await e.hashFunction(JSON.stringify(e.password)):void 0,n={id:ef,context:dn,key:Zs,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:zt(),_rev:mt(),_attachments:{}},i=await e.internalStore.bulkWrite([{document:n}],"internal-add-storage-token");if(i.success[0])return i.success[0];var s=x(i.error[0]);if(s.isError&&Ii(s)){var o=s;if(!rf(o.documentInDb.data.rxdbVersion,e.rxdbVersion))throw m("DM5",{args:{database:e.name,databaseStateVersion:o.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(r&&r!==o.documentInDb.data.passwordHash)throw m("DB1",{passwordHash:r,existingPasswordHash:o.documentInDb.data.passwordHash});var a=o.documentInDb;return x(a)}throw s}function rf(e,t){if(!e||t.includes("beta")&&t!==e)return!1;var r=e.split(".")[0],n=t.split(".")[0];return r===n}function ti(e,t){return e+"-"+t.version}function mr(e,t){return t=L(t),t=La(e,t),t=Pi(e.primaryPath,e.jsonSchema,t),t._meta=zt(),Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=mt()),t}async function nf(e,t){t.multiInstance=e.multiInstance;var r=await e.storage.createStorageInstance(t);return r}async function eo(e,t,r,n,i,s,o){var a=await Xs(t),u=a.filter(h=>h.data.name===i),c=[];u.forEach(h=>{c.push({collectionName:h.data.name,schema:h.data.schema,isCollection:!0}),h.data.connectedStorages.forEach(d=>c.push({collectionName:d.collectionName,isCollection:!1,schema:d.schema}))});var l=new Set;if(c=c.filter(h=>{var d=h.collectionName+"||"+h.schema.version;return l.has(d)?!1:(l.add(d),!0)}),await Promise.all(c.map(async h=>{var d=await e.createStorageInstance({collectionName:h.collectionName,databaseInstanceToken:r,databaseName:n,multiInstance:!1,options:{},schema:h.schema,password:s,devMode:M.isDevMode()});await d.remove(),h.isCollection&&await vt("postRemoveRxCollection",{storage:e,databaseName:n,collectionName:i})})),o){var f=u.map(h=>{var d=Gs(h);return d._deleted=!0,d._meta.lwt=Q(),d._rev=Rr(r,h),{previous:h,document:d}});await t.bulkWrite(f,"rx-database-remove-collection-all")}}var sf=function(){function e(r){this.subs=[],this.limit=100,this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.collection=r,this.subs.push(this.collection.$.pipe(Y(n=>!n.isLocal)).subscribe(n=>this._handleChangeEvent(n)))}var t=e.prototype;return t._handleChangeEvent=function(n){for(this.counter++,this.buffer.push(n),this.eventCounterMap.set(n,this.counter);this.buffer.length>this.limit;)this.buffer.shift()},t.getArrayIndexByPointer=function(n){var i=this.buffer[0],s=this.eventCounterMap.get(i);if(n<s)return null;var o=n-s;return o},t.getFrom=function(n){var i=[],s=this.getArrayIndexByPointer(n);if(s===null)return null;for(;;){var o=this.buffer[s];if(s++,o)i.push(o);else return i}},t.runFrom=function(n,i){var s=this.getFrom(n);if(s===null)throw new Error("out of bounds");s.forEach(o=>i(o))},t.reduceByLastOfDoc=function(n){return n.slice(0)},t.destroy=function(){this.subs.forEach(n=>n.unsubscribe())},e}();function of(e){return new sf(e)}var af=new WeakMap;function uf(e){var t=e.schema.getDocumentPrototype(),r=ff(e),n=_t,i={};return[t,r,n].forEach(s=>{var o=Object.getOwnPropertyNames(s);o.forEach(a=>{var u=Object.getOwnPropertyDescriptor(s,a),c=!0;(a.startsWith("_")||a.endsWith("_")||a.startsWith("$")||a.endsWith("$"))&&(c=!1),typeof u.value=="function"?Object.defineProperty(i,a,{get(){return u.value.bind(this)},enumerable:c,configurable:!1}):(u.enumerable=c,u.configurable=!1,u.writable&&(u.writable=!1),Object.defineProperty(i,a,u))})}),i}function cf(e){return be(af,e,()=>Vs(uf(e)))}function lf(e,t){var r=Yl(cf(e),e,M.deepFreezeWhenDevMode(t));return e._runHooksSync("post","create",t,r),X("postCreateRxDocument",r),r}function ff(e){var t={};return Object.entries(e.methods).forEach(([r,n])=>{t[r]=n}),t}var to=function(e,t){var r=De(e.newDocumentState),n=De(e.realMasterState);return We(r,n)?Promise.resolve({isEqual:!0}):Promise.resolve({isEqual:!1,documentData:e.realMasterState})},ro=["pre","post"],no=["insert","save","remove","create"],ri=!1,pn=function(){function e(r,n,i,s,o={},a={},u={},c={},l={},f=Ws,h={},d=to){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=El(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.onDestroy=[],this.destroyed=!1,this.database=r,this.name=n,this.schema=i,this.internalStorageInstance=s,this.instanceCreationOptions=o,this.migrationStrategies=a,this.methods=u,this.attachments=c,this.options=l,this.cacheReplacementPolicy=f,this.statics=h,this.conflictHandler=d,hf(this.asRxCollection)}var t=e.prototype;return t.prepare=async function(){this.storageInstance=Js(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new Jl(this.storageInstance,this.schema.primaryPath,(o,a)=>Ys(this,o,a),o=>this._runHooks("post","save",o));var n=this.database.eventBulks$.pipe(Y(o=>o.collectionName===this.name));this.$=n.pipe(yt(o=>o.events)),this.checkpoint$=n.pipe(de(o=>o.checkpoint)),this._changeEventBuffer=of(this.asRxCollection),this._docCache=new Il(this.schema.primaryPath,this.$.pipe(Y(o=>!o.isLocal)),o=>lf(this.asRxCollection,o));var i=await this.database.storageToken,s=this.storageInstance.changeStream().subscribe(o=>{var a={id:o.id,internal:!1,collectionName:this.name,storageToken:i,events:o.events.map(u=>Wl(!1,u,this)),databaseToken:this.database.token,checkpoint:o.checkpoint,context:o.context,endTime:o.endTime,startTime:o.startTime};this.database.$emit(a)});return this._subs.push(s),this._subs.push(this.storageInstance.conflictResultionTasks().subscribe(o=>{this.conflictHandler(o.input,o.context).then(a=>{this.storageInstance.resolveConflictResultionTask({id:o.id,output:a})})})),ye},t.cleanup=function(n){throw C("cleanup")},t.migrationNeeded=function(){throw C("migration-schema")},t.getMigrationState=function(){throw C("migration-schema")},t.startMigration=function(n=10){return this.getMigrationState().startMigration(n)},t.migratePromise=function(n=10){return this.getMigrationState().migratePromise(n)},t.insert=async function(n){var i=await this.bulkInsert([n]),s=i.error[0];jt(this,n[this.schema.primaryPath],n,s);var o=x(i.success[0]);return o},t.bulkInsert=async function(n){if(n.length===0)return{success:[],error:[]};var i=this.schema.primaryPath,s=n.map(f=>{var h=mr(this.schema,f);return h}),o=this.hasHooks("pre","insert")?await Promise.all(s.map(f=>this._runHooks("pre","insert",f).then(()=>f))):s,a=o.map(f=>{var h={document:f};return h}),u=await this.storageInstance.bulkWrite(a,"rx-collection-bulk-insert"),c=Hs(this._docCache,u.success);if(this.hasHooks("post","insert")){var l=new Map;o.forEach(f=>{l.set(f[i],f)}),await Promise.all(c.map(f=>this._runHooks("post","insert",l.get(f.primary),f)))}return{success:c,error:u.error}},t.bulkRemove=async function(n){var i=this.schema.primaryPath;if(n.length===0)return{success:[],error:[]};var s=await this.findByIds(n).exec(),o=[],a=new Map;Array.from(s.values()).forEach(h=>{var d=h.toMutableJSON(!0);o.push(d),a.set(h.primary,d)}),await Promise.all(o.map(h=>{var d=h[this.schema.primaryPath];return this._runHooks("pre","remove",h,s.get(d))}));var u=o.map(h=>{var d=L(h);return d._deleted=!0,{previous:h,document:d}}),c=await this.storageInstance.bulkWrite(u,"rx-collection-bulk-remove"),l=c.success.map(h=>h[i]);await Promise.all(l.map(h=>this._runHooks("post","remove",a.get(h),s.get(h))));var f=l.map(h=>ct(s,h));return{success:f,error:c.error}},t.bulkUpsert=async function(n){var i=[],s=new Map;n.forEach(c=>{var l=mr(this.schema,c),f=l[this.schema.primaryPath];if(!f)throw m("COL3",{primaryPath:this.schema.primaryPath,data:l,schema:this.schema.jsonSchema});s.set(f,l),i.push(l)});var o=await this.bulkInsert(i),a=o.success.slice(0),u=[];return await Promise.all(o.error.map(async c=>{if(c.status!==409)u.push(c);else{var l=c.documentId,f=ct(s,l),h=x(c.documentInDb),d=this._docCache.getCachedRxDocument(h),v=await d.incrementalModify(()=>f);a.push(v)}})),{error:u,success:a}},t.upsert=async function(n){var i=await this.bulkUpsert([n]);return jt(this.asRxCollection,n[this.schema.primaryPath],n,i.error[0]),i.success[0]},t.incrementalUpsert=function(n){var i=mr(this.schema,n),s=i[this.schema.primaryPath];if(!s)throw m("COL4",{data:n});var o=this._incrementalUpsertQueues.get(s);return o||(o=ye),o=o.then(()=>mf(this,s,i)).then(a=>a.inserted?a.doc:df(a.doc,i)),this._incrementalUpsertQueues.set(s,o),o},t.find=function(n){if(typeof n=="string")throw m("COL5",{queryObj:n});n||(n=rt());var i=Fe("find",n,this);return i},t.findOne=function(n){if(typeof n=="number"||Array.isArray(n))throw z("COL6",{queryObj:n});var i;if(typeof n=="string")i=Fe("findOne",{selector:{[this.schema.primaryPath]:n},limit:1},this);else{if(n||(n=rt()),n.limit)throw m("QU6");n=L(n),n.limit=1,i=Fe("findOne",n,this)}return i},t.count=function(n){n||(n=rt());var i=Fe("count",n,this);return i},t.findByIds=function(n){var i={selector:{[this.schema.primaryPath]:{$in:n.slice(0)}}},s=Fe("findByIds",i,this);return s},t.exportJSON=function(){throw C("json-dump")},t.importJSON=function(n){throw C("json-dump")},t.insertCRDT=function(n){throw C("crdt")},t.addHook=function(n,i,s,o=!1){if(typeof s!="function")throw z("COL7",{key:i,when:n});if(!ro.includes(n))throw z("COL8",{key:i,when:n});if(!no.includes(i))throw m("COL9",{key:i});if(n==="post"&&i==="create"&&o===!0)throw m("COL10",{when:n,key:i,parallel:o});var a=s.bind(this),u=o?"parallel":"series";this.hooks[i]=this.hooks[i]||{},this.hooks[i][n]=this.hooks[i][n]||{series:[],parallel:[]},this.hooks[i][n][u].push(a)},t.getHooks=function(n,i){return!this.hooks[i]||!this.hooks[i][n]?{series:[],parallel:[]}:this.hooks[i][n]},t.hasHooks=function(n,i){var s=this.getHooks(n,i);return s?s.series.length>0||s.parallel.length>0:!1},t._runHooks=function(n,i,s,o){var a=this.getHooks(n,i);if(!a)return ye;var u=a.series.map(c=>()=>c(s,o));return ga(u).then(()=>Promise.all(a.parallel.map(c=>c(s,o))))},t._runHooksSync=function(n,i,s,o){var a=this.getHooks(n,i);a&&a.series.forEach(u=>u(s,o))},t.promiseWait=function(n){var i=new Promise(s=>{var o=setTimeout(()=>{this.timeouts.delete(o),s()},n);this.timeouts.add(o)});return i},t.destroy=function(){return this.destroyed?le:(this.destroyed=!0,Array.from(this.timeouts).forEach(n=>clearTimeout(n)),this._changeEventBuffer&&this._changeEventBuffer.destroy(),this.database.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(n=>n()))).then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(n=>n.unsubscribe()),delete this.database.collections[this.name],vt("postDestroyRxCollection",this).then(()=>!0))))},t.remove=async function(){await this.destroy(),await eo(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.password,this.database.hashFunction)},we(e,[{key:"insert$",get:function(){return this.$.pipe(Y(r=>r.operation==="INSERT"))}},{key:"update$",get:function(){return this.$.pipe(Y(r=>r.operation==="UPDATE"))}},{key:"remove$",get:function(){return this.$.pipe(Y(r=>r.operation==="DELETE"))}},{key:"asRxCollection",get:function(){return this}}])}();function hf(e){if(!ri){ri=!0;var t=Object.getPrototypeOf(e);no.forEach(r=>{ro.map(n=>{var i=n+Oi(r);t[i]=function(s,o){return this.addHook(n,r,s,o)}})})}}function df(e,t){return e.incrementalModify(r=>t)}function mf(e,t,r){var n=e._docCache.getLatestDocumentDataIfExists(t);return n?Promise.resolve({doc:e._docCache.getCachedRxDocument(n),inserted:!1}):e.findOne(t).exec().then(i=>i?{doc:i,inserted:!1}:e.insert(r).then(s=>({doc:s,inserted:!0})))}function pf({database:e,name:t,schema:r,instanceCreationOptions:n={},migrationStrategies:i={},autoMigrate:s=!0,statics:o={},methods:a={},attachments:u={},options:c={},localDocuments:l=!1,cacheReplacementPolicy:f=Ws,conflictHandler:h=to}){var d={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:r.jsonSchema,options:n,multiInstance:e.multiInstance,password:e.password,devMode:M.isDevMode()};return X("preCreateRxStorageInstance",d),nf(e,d).then(v=>{var p=new pn(e,t,r,v,n,i,a,u,c,f,o,h);return p.prepare().then(()=>{Object.entries(o).forEach(([b,y])=>{Object.defineProperty(p,b,{get:()=>y.bind(p)})});var g=ye;return s&&p.schema.version!==0&&(g=p.migratePromise()),g}).then(()=>(X("createRxCollection",{collection:p,creator:{name:t,schema:r,storageInstance:v,instanceCreationOptions:n,migrationStrategies:i,methods:a,attachments:u,options:c,cacheReplacementPolicy:f,localDocuments:l,statics:o}}),p)).catch(g=>v.close().then(()=>Promise.reject(g)))})}var io=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=t||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};io.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,Hr(this)},wrapCall:function(t){var r=this;this.lock();var n;try{n=t()}catch(i){throw this.unlock(),i}return!n.then||typeof n.then!="function"?(this.unlock(),n):n.then(function(i){return r.unlock(),i}).catch(function(i){throw r.unlock(),i})},requestIdlePromise:function(t){var r=this;t=t||{};var n,i=new Promise(function(a){return n=a}),s=function(){pr(r,i),n()};if(i._manRes=s,t.timeout){var o=setTimeout(function(){i._manRes()},t.timeout);i._timeoutObj=o}return this._iC.add(i),Hr(this),i},cancelIdlePromise:function(t){pr(this,t)},requestIdleCallback:function(t,r){var n=this._lHN++,i=this.requestIdlePromise(r);return this._hPM.set(n,i),this._pHM.set(i,n),i.then(function(){return t()}),n},cancelIdleCallback:function(t){var r=this._hPM.get(t);this.cancelIdlePromise(r)},clear:function(){var t=this;this._iC.forEach(function(r){return pr(t,r)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function vf(e){if(e._iC.size!==0){var t=e._iC.values(),r=t.next().value;r._manRes(),setTimeout(function(){return Hr(e)},0)}}function pr(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var r=e._pHM.get(t);e._hPM.delete(r),e._pHM.delete(t)}e._iC.delete(t)}}function Hr(e){e._tryIR||e._iC.size===0||(e._tryIR=!0,setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}vf(e),e._tryIR=!1},0)},0))}class vn{constructor(t){Pt(this,"ttl");Pt(this,"map",new Map);Pt(this,"_to",!1);this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,so()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,yf(this)},0))}clear(){this.map.clear()}}function yf(e){const t=so()-e.ttl,r=e.map[Symbol.iterator]();for(;;){const n=r.next().value;if(!n)return;const i=n[0];if(n[1]<t)e.map.delete(i);else return}}function so(){return Date.now()}var Wt=new Set,yn=function(){function e(r,n,i,s,o,a,u=!1,c={},l,f,h,d,v){this.idleQueue=new io,this.rxdbVersion=Ci,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onDestroy=[],this.destroyed=!1,this.collections={},this.states={},this.eventBulks$=new Me,this.observable$=this.eventBulks$.pipe(yt(p=>p.events)),this.storageToken=le,this.storageTokenDocument=le,this.emittedEventBulkIds=new vn(60*1e3),this.name=r,this.token=n,this.storage=i,this.instanceCreationOptions=s,this.password=o,this.multiInstance=a,this.eventReduce=u,this.options=c,this.internalStore=l,this.hashFunction=f,this.cleanupPolicy=h,this.allowSlowCount=d,this.reactivity=v,this.name!=="pseudoInstance"&&(this.internalStore=Js(this.asRxDatabase,l,mn),this.storageTokenDocument=tf(this.asRxDatabase).catch(p=>this.startupErrors.push(p)),this.storageToken=this.storageTokenDocument.then(p=>p.data.token).catch(p=>this.startupErrors.push(p)))}var t=e.prototype;return t.getReactivityFactory=function(){if(!this.reactivity)throw m("DB14",{database:this.name});return this.reactivity},t.$emit=function(n){this.emittedEventBulkIds.has(n.id)||(this.emittedEventBulkIds.add(n.id),this.eventBulks$.next(n))},t.removeCollectionDoc=async function(n,i){var s=await jl(this.internalStore,Wr(ti(n,i),nt));if(!s)throw m("SNH",{name:n,schema:i});var o=Gs(s);o._deleted=!0,await this.internalStore.bulkWrite([{document:o,previous:s}],"rx-database-remove-collection")},t.addCollections=async function(n){var i={},s={},o=[],a={};await Promise.all(Object.entries(n).map(async([l,f])=>{var h=l,d=f.schema;i[h]=d;var v=Na(d,this.hashFunction);if(s[h]=v,this.collections[l])throw m("DB3",{name:l});var p=ti(l,d),g={id:Wr(p,nt),key:p,context:nt,data:{name:h,schemaHash:await v.hash,schema:v.jsonSchema,version:v.version,connectedStorages:[]},_deleted:!1,_meta:zt(),_rev:mt(),_attachments:{}};o.push({document:g});var b=Object.assign({},f,{name:h,schema:v,database:this}),y=L(f);y.database=this,y.name=l,X("preCreateRxCollection",y),b.conflictHandler=y.conflictHandler,a[h]=b}));var u=await this.internalStore.bulkWrite(o,"rx-database-add-collection");await _f(this),await Promise.all(u.error.map(async l=>{if(l.status!==409)throw m("DB12",{database:this.name,writeError:l});var f=x(l.documentInDb),h=f.data.name,d=s[h];if(f.data.schemaHash!==await d.hash)throw m("DB6",{database:this.name,collection:h,previousSchemaHash:f.data.schemaHash,schemaHash:await d.hash,previousSchema:f.data.schema,schema:x(i[h])})}));var c={};return await Promise.all(Object.keys(n).map(async l=>{var f=a[l],h=await pf(f);c[l]=h,this.collections[l]=h,this[l]||Object.defineProperty(this,l,{get:()=>this.collections[l]})})),c},t.lockedRun=function(n){return this.idleQueue.wrapCall(n)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(n){throw C("json-dump")},t.addState=function(n){throw C("state")},t.importJSON=function(n){throw C("json-dump")},t.backup=function(n){throw C("backup")},t.leaderElector=function(){throw C("leader-election")},t.isLeader=function(){throw C("leader-election")},t.waitForLeadership=function(){throw C("leader-election")},t.migrationStates=function(){throw C("migration-schema")},t.destroy=async function(){return this.destroyed||(this.destroyed=!0,await vt("preDestroyRxDatabase",this),this.eventBulks$.complete(),this._subs.map(n=>n.unsubscribe()),this.name==="pseudoInstance")?le:this.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(n=>n()))).then(()=>Promise.all(Object.keys(this.collections).map(n=>this.collections[n]).map(n=>n.destroy()))).then(()=>this.internalStore.close()).then(()=>Wt.delete(this.storage.name+"|"+this.name)).then(()=>!0)},t.remove=function(){return this.destroy().then(()=>wf(this.name,this.storage,this.password))},we(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])}();function gf(e,t){var r=t.name+"|"+e;if(Wt.has(r))throw m("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}async function oo(e,t,r,n,i,s){var o=await t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:ql,schema:mn,options:n,multiInstance:i,password:s,devMode:M.isDevMode()});return o}function bf({storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:i=!0,eventReduce:s=!0,ignoreDuplicate:o=!1,options:a={},cleanupPolicy:u,allowSlowCount:c=!1,localDocuments:l=!1,hashFunction:f=da,reactivity:h}){X("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:i,eventReduce:s,ignoreDuplicate:o,options:a,localDocuments:l}),o||gf(r,e),Wt.add(e.name+"|"+r);var d=pt(10);return oo(d,e,r,t,i,n).catch(v=>{throw Wt.delete(e.name+"|"+r),v}).then(v=>{var p=new yn(r,d,e,t,n,i,s,a,v,f,u,c,h);return vt("createRxDatabase",{database:p,creator:{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:i,eventReduce:s,ignoreDuplicate:o,options:a,localDocuments:l}}).then(()=>p)})}async function wf(e,t,r){var n=pt(10),i=await oo(n,t,e,{},!1,r),s=await Xs(i),o=new Set;s.forEach(u=>o.add(u.data.name));var a=Array.from(o);return await Promise.all(a.map(u=>eo(t,i,n,e,u,r))),await vt("postRemoveRxDatabase",{databaseName:e,storage:t}),await i.remove(),a}async function _f(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}var Of={RxSchema:Ai.prototype,RxDocument:_t,RxQuery:Ks.prototype,RxCollection:pn.prototype,RxDatabase:yn.prototype},vr=new Set,ni=new Set;function Ot(e){if(X("preAddRxPlugin",{plugin:e,plugins:vr}),!vr.has(e)){{if(ni.has(e.name))throw m("PL3",{name:e.name,plugin:e});vr.add(e),ni.add(e.name)}if(!e.rxdb)throw z("PL1",{plugin:e});e.init&&e.init(),e.prototypes&&Object.entries(e.prototypes).forEach(([t,r])=>r(Of[t])),e.overwritable&&Object.assign(M,e.overwritable),e.hooks&&Object.entries(e.hooks).forEach(([t,r])=>{r.after&&ft[t].push(r.after),r.before&&ft[t].unshift(r.before)})}}function Ef(e){return e&&typeof e.then=="function"}Promise.resolve(!1);var Sf=Promise.resolve(!0),ne=Promise.resolve();function xe(e,t){return e||(e=0),new Promise(function(r){return setTimeout(function(){return r(t)},e)})}function Cf(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Et(){return Math.random().toString(36).substring(2)}var yr=0;function St(){var e=Date.now()*1e3;return e<=yr&&(e=yr+1),yr=e,e}function Rf(){return typeof navigator<"u"&&typeof navigator.locks<"u"&&typeof navigator.locks.request=="function"}var Df=St,xf="native";function If(e){var t={time:St(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function Pf(e){e.bc.close(),e.subFns=[]}function kf(e,t){try{return e.bc.postMessage(t,!1),ne}catch(r){return Promise.reject(r)}}function Mf(e,t){e.messagesCallback=t}function Af(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function Lf(){return 150}var Tf={create:If,close:Pf,onMessage:Mf,postMessage:kf,canBeUsed:Af,type:xf,averageResponseTime:Lf,microSeconds:Df};function gn(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var $f=St,Nf="pubkey.broadcast-channel-0-",ue="messages",Yt={durability:"relaxed"},Bf="idb";function ao(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function bn(e){e.commit&&e.commit()}function Ff(e){var t=ao(),r=Nf+e,n=t.open(r);return n.onupgradeneeded=function(i){var s=i.target.result;s.createObjectStore(ue,{keyPath:"id",autoIncrement:!0})},new Promise(function(i,s){n.onerror=function(o){return s(o)},n.onsuccess=function(){i(n.result)}})}function Uf(e,t,r){var n=Date.now(),i={uuid:t,time:n,data:r},s=e.transaction([ue],"readwrite",Yt);return new Promise(function(o,a){s.oncomplete=function(){return o()},s.onerror=function(c){return a(c)};var u=s.objectStore(ue);u.add(i),bn(s)})}function qf(e,t){var r=e.transaction(ue,"readonly",Yt),n=r.objectStore(ue),i=[],s=IDBKeyRange.bound(t+1,1/0);if(n.getAll){var o=n.getAll(s);return new Promise(function(u,c){o.onerror=function(l){return c(l)},o.onsuccess=function(l){u(l.target.result)}})}function a(){try{return s=IDBKeyRange.bound(t+1,1/0),n.openCursor(s)}catch{return n.openCursor()}}return new Promise(function(u,c){var l=a();l.onerror=function(f){return c(f)},l.onsuccess=function(f){var h=f.target.result;h?h.value.id<t+1?h.continue(t+1):(i.push(h.value),h.continue()):(bn(r),u(i))}})}function jf(e,t){if(e.closed)return Promise.resolve([]);var r=e.db.transaction(ue,"readwrite",Yt),n=r.objectStore(ue);return Promise.all(t.map(function(i){var s=n.delete(i);return new Promise(function(o){s.onsuccess=function(){return o()}})}))}function Wf(e,t){var r=Date.now()-t,n=e.transaction(ue,"readonly",Yt),i=n.objectStore(ue),s=[];return new Promise(function(o){i.openCursor().onsuccess=function(a){var u=a.target.result;if(u){var c=u.value;c.time<r?(s.push(c),u.continue()):(bn(n),o(s))}else o(s)}})}function Hf(e){return Wf(e.db,e.options.idb.ttl).then(function(t){return jf(e,t.map(function(r){return r.id}))})}function Kf(e,t){return t=gn(t),Ff(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Et(),eMIs:new vn(t.idb.ttl*2),writeBlockPromise:ne,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},uo(n),n})}function uo(e){e.closed||co(e).then(function(){return xe(e.options.idb.fallbackInterval)}).then(function(){return uo(e)})}function Qf(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function co(e){return e.closed||!e.messagesCallback?ne:qf(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return Qf(n,e)}).sort(function(n,i){return n.time-i.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),ne})}function zf(e){e.closed=!0,e.db.close()}function Gf(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return Uf(e.db,e.uuid,t)}).then(function(){Cf(0,10)===0&&Hf(e)}),e.writeBlockPromise}function Jf(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,co(e)}function Vf(){return!!ao()}function Yf(e){return e.idb.fallbackInterval*2}var Xf={create:Kf,close:zf,onMessage:Jf,postMessage:Gf,canBeUsed:Vf,type:Bf,averageResponseTime:Yf,microSeconds:$f},Zf=St,eh="pubkey.broadcastChannel-",th="localstorage";function lo(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function fo(e){return eh+e}function rh(e,t){return new Promise(function(r){xe().then(function(){var n=fo(e.channelName),i={token:Et(),time:Date.now(),data:t,uuid:e.uuid},s=JSON.stringify(i);lo().setItem(n,s);var o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=n,o.newValue=s,window.dispatchEvent(o),r()})})}function nh(e,t){var r=fo(e),n=function(s){s.key===r&&t(JSON.parse(s.newValue))};return window.addEventListener("storage",n),n}function ih(e){window.removeEventListener("storage",e)}function sh(e,t){if(t=gn(t),!ho())throw new Error("BroadcastChannel: localstorage cannot be used");var r=Et(),n=new vn(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:n};return i.listener=nh(e,function(s){i.messagesCallback&&s.uuid!==r&&(!s.token||n.has(s.token)||s.data.time&&s.data.time<i.messagesCallbackTime||(n.add(s.token),i.messagesCallback(s.data)))}),i}function oh(e){ih(e.listener)}function ah(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function ho(){var e=lo();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function uh(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}var ch={create:sh,close:oh,onMessage:ah,postMessage:rh,canBeUsed:ho,type:th,averageResponseTime:uh,microSeconds:Zf},mo=St,lh="simulate",wn=new Set;function fh(e){var t={time:mo(),name:e,messagesCallback:null};return wn.add(t),t}function hh(e){wn.delete(e)}var po=5;function dh(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(wn);n.forEach(function(i){i.name===e.name&&i!==e&&i.messagesCallback&&i.time<t.time&&i.messagesCallback(t)}),r()},po)})}function mh(e,t){e.messagesCallback=t}function ph(){return!0}function vh(){return po}var yh={create:fh,close:hh,onMessage:mh,postMessage:dh,canBeUsed:ph,type:lh,averageResponseTime:vh,microSeconds:mo},ii=[Tf,Xf,ch];function gh(e){var t=[].concat(e.methods,ii).filter(Boolean);if(e.type){if(e.type==="simulate")return yh;var r=t.find(function(i){return i.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(i){return i.type!=="idb"}));var n=t.find(function(i){return i.canBeUsed()});if(n)return n;throw new Error("No usable method found in "+JSON.stringify(ii.map(function(i){return i.type})))}var vo=new Set,bh=0,_n=function(t,r){this.id=bh++,vo.add(this),this.name=t,si&&(r=si),this.options=gn(r),this.method=gh(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,wh(this)};_n._pubkey=!0;var si;_n.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return oi(this,"message",t)},postInternal:function(t){return oi(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};ui(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,ai(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),i={time:n,fn:r};ai(this,t,i)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(i){return i.fn===r});ui(this,t,n)},close:function(){var t=this;if(!this.closed){vo.delete(this),this.closed=!0;var r=this._prepP?this._prepP:ne;return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function oi(e,t,r){var n=e.method.microSeconds(),i={time:n,type:t,data:r},s=e._prepP?e._prepP:ne;return s.then(function(){var o=e.method.postMessage(e._state,i);return e._uMP.add(o),o.catch().then(function(){return e._uMP.delete(o)}),o})}function wh(e){var t=e.method.create(e.name,e.options);Ef(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function yo(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function ai(e,t,r){e._addEL[t].push(r),_h(e)}function ui(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),Oh(e)}function _h(e){if(!e._iL&&yo(e)){var t=function(i){e._addEL[i.type].forEach(function(s){i.time>=s.time&&s.fn(i.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function Oh(e){if(e._iL&&!yo(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}function Eh(e){if(typeof WorkerGlobalScope=="function"&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if(typeof window.addEventListener!="function")return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}}function Sh(e){process.on("exit",function(){return e()}),process.on("beforeExit",function(){return e().then(function(){return process.exit()})}),process.on("SIGINT",function(){return e().then(function(){return process.exit()})}),process.on("uncaughtException",function(t){return e().then(function(){console.trace(t),process.exit(101)})})}var Ch=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Rh=Ch?Sh:Eh,it=new Set,ci=!1;function Dh(){ci||(ci=!0,Rh(Ih))}function xh(e){if(Dh(),typeof e!="function")throw new Error("Listener is no function");it.add(e);var t={remove:function(){return it.delete(e)},run:function(){return it.delete(e),e()}};return t}function Ih(){var e=[];return it.forEach(function(t){e.push(t()),it.delete(t)}),Promise.all(e)}function ke(e,t){var r={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(r)}function go(e){e.isLeader=!0,e._hasLeader=!0;var t=xh(function(){return e.die()});e._unl.push(t);var r=function(i){i.context==="leader"&&i.action==="apply"&&ke(e,"tell"),i.context==="leader"&&i.action==="tell"&&!e._dpLC&&(e._dpLC=!0,e._dpL(),ke(e,"tell"))};return e.broadcastChannel.addEventListener("internal",r),e._lstns.push(r),ke(e,"tell")}var bo=function(t,r){var n=this;this.broadcastChannel=t,t._befC.push(function(){return n.die()}),this._options=r,this.isLeader=!1,this.isDead=!1,this.token=Et(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+t.method.type+"||"+t.name};bo.prototype={hasLeader:function(){var t=this;return navigator.locks.query().then(function(r){var n=r.held?r.held.filter(function(i){return i.name===t.lN}):[];return!!(n&&n.length>0)})},awaitLeadership:function(){var t=this;if(!this._wLMP){this._wKMC.c=new AbortController;var r=new Promise(function(n,i){t._wKMC.res=n,t._wKMC.rej=i});this._wLMP=new Promise(function(n){navigator.locks.request(t.lN,{signal:t._wKMC.c.signal},function(){return t._wKMC.c=void 0,go(t),n(),r}).catch(function(){})})}return this._wLMP},set onduplicate(e){},die:function(){var t=this;return this._lstns.forEach(function(r){return t.broadcastChannel.removeEventListener("internal",r)}),this._lstns=[],this._unl.forEach(function(r){return r.remove()}),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),ke(this,"death")}};var wo=function(t,r){var n=this;this.broadcastChannel=t,this._options=r,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=Et(),this._aplQ=ne,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var i=function(o){o.context==="leader"&&(o.action==="death"&&(n._hasLeader=!1),o.action==="tell"&&(n._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",i),this._lstns.push(i)};wo.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(t){var r=this;if(this.isLeader)return xe(0,!0);if(this.isDead)return xe(0,!1);if(this._aplQC>1)return this._aplQ;var n=function(){if(r.isLeader)return Sf;var s=!1,o,a=new Promise(function(l){o=function(){s=!0,l()}}),u=function(f){f.context==="leader"&&f.token!=r.token&&(f.action==="apply"&&f.token>r.token&&o(),f.action==="tell"&&(o(),r._hasLeader=!0))};r.broadcastChannel.addEventListener("internal",u);var c=t?r._options.responseTime*4:r._options.responseTime;return ke(r,"apply").then(function(){return Promise.race([xe(c),a.then(function(){return Promise.reject(new Error)})])}).then(function(){return ke(r,"apply")}).then(function(){return Promise.race([xe(c),a.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return r.broadcastChannel.removeEventListener("internal",u),s?!1:go(r).then(function(){return!0})})};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(function(){return n()}).then(function(){r._aplQC=r._aplQC-1}),this._aplQ.then(function(){return r.isLeader})},awaitLeadership:function(){return this._aLP||(this._aLP=Ph(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;return this._lstns.forEach(function(r){return t.broadcastChannel.removeEventListener("internal",r)}),this._lstns=[],this._unl.forEach(function(r){return r.remove()}),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,ke(this,"death")}};function Ph(e){return e.isLeader?ne:new Promise(function(t){var r=!1;function n(){r||(r=!0,e.broadcastChannel.removeEventListener("internal",s),t(!0))}e.applyOnce().then(function(){e.isLeader&&n()});var i=function o(){return xe(e._options.fallbackInterval).then(function(){if(!(e.isDead||r))if(e.isLeader)n();else return e.applyOnce(!0).then(function(){e.isLeader?n():o()})})};i();var s=function(a){a.context==="leader"&&a.action==="death"&&(e._hasLeader=!1,e.applyOnce().then(function(){e.isLeader&&n()}))};e.broadcastChannel.addEventListener("internal",s),e._lstns.push(s)})}function kh(e,t){return e||(e={}),e=JSON.parse(JSON.stringify(e)),e.fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}function Mh(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=kh(t,e);var r=Rf()?new bo(e,t):new wo(e,t);return e._befC.push(function(){return r.die()}),e._leaderElector=r,r}var Ht=new Map;function Ah(e,t,r,n){var i=Ht.get(t);return i||(i={bc:new _n(["RxDB:",e,r].join("|")),refs:new Set},Ht.set(t,i)),i.refs.add(n),i.bc}function Lh(e,t){var r=Ht.get(e);if(r&&(r.refs.delete(t),r.refs.size===0))return Ht.delete(e),r.bc.close()}function Th(e,t){var r=t.map(n=>{var i=Z(e,n);if(!i)throw new Error("not in schema: "+n);var s=i.type,o;(s==="number"||s==="integer")&&(o=On(i));var a=wi(n),u=i.maxLength?i.maxLength:0,c;s==="string"?c=f=>{var h=a(f);return h||(h=""),h.padEnd(u," ")}:s==="boolean"?c=f=>{var h=a(f);return h?"1":"0"}:c=f=>{var h=a(f);return Kt(o,h)};var l={fieldName:n,schemaPart:i,parsedLengths:o,getValue:a,getIndexStringPart:c};return l});return r}function $h(e,t){var r=Th(e,t),n=r.length,i=r.map(o=>o.getIndexStringPart),s=function(o){for(var a="",u=0;u<n;++u)a+=i[u](o);return a};return s}function On(e){var t=Math.floor(e.minimum),r=Math.ceil(e.maximum),n=e.multipleOf,i=r-t,s=i.toString().length,o=n.toString().split("."),a=0;return o.length>1&&(a=o[1].length),{minimum:t,maximum:r,nonDecimals:s,decimals:a,roundedMinimum:t}}function Kt(e,t){typeof t>"u"&&(t=0),t<e.minimum&&(t=e.minimum),t>e.maximum&&(t=e.maximum);var r=(Math.floor(t)-e.roundedMinimum).toString(),n=r.padStart(e.nonDecimals,"0");if(e.decimals>0){var i=t.toString().split("."),s=i.length>1?i[1]:"0";n+=s.padEnd(e.decimals,"0")}return n}function li(e,t,r){var n="";return t.forEach((i,s)=>{var o=Z(e,i),a=r[s],u=o.type;switch(u){case"string":var c=x(o.maxLength,"maxLength not set");typeof a=="string"?n+=a.padEnd(c," "):n+="".padEnd(c," ");break;case"boolean":if(a===null)n+="0";else if(a===re)n+="0";else if(a===te)n+="1";else{var l=a?"1":"0";n+=l}break;case"number":case"integer":var f=On(o);if(a===null||a===re){var h="0";n+=h.repeat(f.nonDecimals+f.decimals)}else if(a===te)n+=Kt(f,f.maximum);else{var d=Kt(f,a);n+=d}break;default:throw new Error("unknown index type "+u)}}),n}function Nh(e,t,r){var n="";return t.forEach((i,s)=>{var o=Z(e,i),a=r[s],u=o.type;switch(u){case"string":var c=x(o.maxLength,"maxLength not set");typeof a=="string"&&a!==te?n+=a.padEnd(c," "):a===re?n+="".padEnd(c," "):n+="".padEnd(c,te);break;case"boolean":if(a===null)n+="1";else{var l=a?"1":"0";n+=l}break;case"number":case"integer":var f=On(o);if(a===null||a===te){var h="9";n+=h.repeat(f.nonDecimals+f.decimals)}else if(a===re){var d="0";n+=d.repeat(f.nonDecimals+f.decimals)}else n+=Kt(f,a);break;default:throw new Error("unknown index type "+u)}}),n}function Bh(e,t,r,n,i){for(var s=i+1;n<=i;){var o=n+i>>>1,a=e[o],u=r!==void 0?r(a,t):a-t;u>=0?(s=o,i=o-1):n=o+1}return s}function Fh(e,t,r,n,i){for(var s=i+1;n<=i;){var o=n+i>>>1,a=e[o],u=r!==void 0?r(a,t):a-t;u>0?(s=o,i=o-1):n=o+1}return s}function Uh(e,t,r,n,i){for(var s=n-1;n<=i;){var o=n+i>>>1,a=e[o],u=r!==void 0?r(a,t):a-t;u<0?(s=o,n=o+1):i=o-1}return s}function qh(e,t,r,n,i){for(var s=n-1;n<=i;){var o=n+i>>>1,a=e[o],u=r!==void 0?r(a,t):a-t;u<=0?(s=o,n=o+1):i=o-1}return s}function jh(e,t,r,n,i){for(;n<=i;){var s=n+i>>>1,o=e[s],a=r!==void 0?r(o,t):o-t;if(a===0)return s;a<=0?n=s+1:i=s-1}return-1}function Ct(e,t,r,n,i,s){return typeof r=="function"?s(e,t,r,n===void 0?0:n|0,i===void 0?e.length-1:i|0):s(e,t,void 0,r===void 0?0:r|0,n===void 0?e.length-1:n|0)}function Wh(e,t,r,n,i){return Ct(e,t,r,n,i,Bh)}function fi(e,t,r,n,i){return Ct(e,t,r,n,i,Fh)}function Hh(e,t,r,n,i){return Ct(e,t,r,n,i,Uh)}function Kh(e,t,r,n,i){return Ct(e,t,r,n,i,qh)}function _o(e,t,r,n,i){return Ct(e,t,r,n,i,jh)}function Oo(e,t,r){return[e,t,r].join("--memory--")}function Mt(e){if(e.internals.removed)throw new Error("removed")}function At(e,t){return e+"||"+t}function Qh(e,t){return e.indexString<t.indexString?-1:1}function hi(e,t,r,n,i){var s=n.document;t.documents.set(e,s);for(var o=0;o<r.length;++o){var a=r[o],u=a.docsWithIndex,c=a.getIndexableString,l=c(s),f=as(u,{id:e,doc:s,indexString:l},Qh,0);if(i){var h=c(i);if(h===l){var d=u[f-1];if(d&&d.id===e)u.splice(f-1,1);else{var v=u[f+1];if(v.id===e)u.splice(f+1,1);else throw m("SNH",{args:{row:n,byIndex:a}})}}else{var p=_o(u,{indexString:h},st);u.splice(p,1)}}}}function zh(e,t,r,n){var i=n[e];r.documents.delete(i),Object.values(r.byIndex).forEach(s=>{var o=s.docsWithIndex,a=s.getIndexableString(n),u=_o(o,{indexString:a},st);o.splice(u,1)})}function st(e,t){var r=e.indexString,n=t.indexString;return r<n?-1:r===n?0:1}function Gh(e,t){var r=ce(t.primaryKey),n=t.indexes?t.indexes.map(i=>gi(i)):[];n.push(["_deleted","_meta.lwt",r]),n.forEach(i=>{e.byIndex[Kr(i)]={index:i,docsWithIndex:[],getIndexableString:$h(t,i)}})}function Kr(e){return e.join(",")}var di=new Set,Jh=function(){function e(r,n,i,s,o,a,u){this.closed=!1,this.storage=r,this.databaseName=n,this.collectionName=i,this.schema=s,this.internals=o,this.options=a,this.settings=u,di.add(this),this.primaryPath=ce(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=function(n,i){this.ensurePersistence(),Mt(this);for(var s=this.internals,o=this.internals.documents,a=this.primaryPath,u=Hl(this,a,o,n,i),c=u.errors,l=new Array(u.bulkInsertDocs.length),f=u.bulkInsertDocs,h=0;h<f.length;++h){var d=f[h],v=d.document;l[h]=v}for(var p=u.bulkUpdateDocs,g=0;g<p.length;++g){var b=p[g],y=b.document;l.push(y)}if(this.internals.ensurePersistenceTask=u,this.internals.ensurePersistenceIdlePromise||(this.internals.ensurePersistenceIdlePromise=Qr().then(()=>{this.internals.ensurePersistenceIdlePromise=void 0,this.ensurePersistence()})),u.eventBulk.events.length>0){var w=x(u.newestRow).document;u.eventBulk.checkpoint={id:w[a],lwt:w._meta.lwt},u.eventBulk.endTime=Q(),ut.then(()=>{s.changes$.next(u.eventBulk)})}var I=Promise.resolve({success:l,error:c});return I},t.ensurePersistence=function(){if(this.internals.ensurePersistenceTask){var n=this.internals,i=this.internals.documents,s=this.primaryPath,o=this.internals.ensurePersistenceTask;this.internals.ensurePersistenceTask=void 0;for(var a=Object.values(this.internals.byIndex),u=o.bulkInsertDocs,c=0;c<u.length;++c){var l=u[c],f=l.document,h=f[s];hi(h,n,a,l,void 0)}for(var d=o.bulkUpdateDocs,v=0;v<d.length;++v){var p=d[v],g=p.document,b=g[s];hi(b,n,a,p,i.get(b))}if(this.schema.attachments){var y=n.attachments;o.attachmentsAdd.forEach(w=>{y.set(At(w.documentId,w.attachmentId),{writeData:w.attachmentData,digest:w.digest})}),this.schema.attachments&&(o.attachmentsUpdate.forEach(w=>{y.set(At(w.documentId,w.attachmentId),{writeData:w.attachmentData,digest:w.digest})}),o.attachmentsRemove.forEach(w=>{y.delete(At(w.documentId,w.attachmentId))}))}}},t.findDocumentsById=function(n,i){this.ensurePersistence();var s=this.internals.documents,o=[];if(s.size===0)return Promise.resolve(o);for(var a=0;a<n.length;++a){var u=n[a],c=s.get(u);c&&(!c._deleted||i)&&o.push(c)}return Promise.resolve(o)},t.query=function(n){this.ensurePersistence();var i=n.queryPlan,s=n.query,o=s.skip?s.skip:0,a=s.limit?s.limit:1/0,u=o+a,c=!1;i.selectorSatisfiedByIndex||(c=fn(this.schema,n.query));var l=i.index,f=!i.sortSatisfiedByIndex,h=l,d=i.startKeys,v=li(this.schema,h,d),p=i.endKeys;p=p;var g=Nh(this.schema,h,p),b=Kr(h);if(!this.internals.byIndex[b])throw new Error("index does not exist "+b);for(var y=this.internals.byIndex[b].docsWithIndex,w=(i.inclusiveStart?Wh:fi)(y,{indexString:v},st),I=(i.inclusiveEnd?Kh:Hh)(y,{indexString:g},st),_=[],E=!1;!E;){var O=y[w];if(!O||w>I)break;var R=O.doc;(!c||c(R))&&_.push(R),_.length>=u&&!f&&(E=!0),w++}if(f){var T=js(this.schema,n.query);_=_.sort(T)}return _=_.slice(o,u),Promise.resolve({documents:_})},t.count=async function(n){this.ensurePersistence();var i=await this.query(n);return{count:i.documents.length,mode:"fast"}},t.cleanup=function(n){this.ensurePersistence();for(var i=Q()-n,s=["_deleted","_meta.lwt",this.primaryPath],o=Kr(s),a=this.internals.byIndex[o].docsWithIndex,u=li(this.schema,s,[!0,0,""]),c=fi(a,{indexString:u},st),l=!1;!l;){var f=a[c];!f||f.doc._meta.lwt>i?l=!0:(zh(this.primaryPath,this.schema,this.internals,f.doc),c++)}return ut},t.getAttachmentData=function(n,i,s){this.ensurePersistence(),Mt(this);var o=At(n,i),a=this.internals.attachments.get(o);if(!s||!a||a.digest!==s)throw new Error("attachment does not exist: "+o);return Promise.resolve(a.writeData.data)},t.changeStream=function(){return Mt(this),this.internals.changes$.asObservable()},t.remove=async function(){if(this.closed)throw new Error("closed");this.ensurePersistence(),Mt(this),this.internals.removed=!0,this.storage.collectionStates.delete(Oo(this.databaseName,this.collectionName,this.schema.version)),await this.close()},t.close=function(){return di.delete(this),this.ensurePersistence(),this.closed||(this.closed=!0,this.internals.refCount=this.internals.refCount-1),ye},t.conflictResultionTasks=function(){return this.internals.conflictResultionTasks$.asObservable()},t.resolveConflictResultionTask=function(n){return ye},e}();function Vh(e,t,r){var n=Oo(t.databaseName,t.collectionName,t.schema.version),i=e.collectionStates.get(n);if(!i)i={id:pt(5),schema:t.schema,removed:!1,refCount:1,documents:new Map,attachments:t.schema.attachments?new Map:void 0,byIndex:{},conflictResultionTasks$:new Me,changes$:new Me},Gh(i,t.schema),e.collectionStates.set(n,i);else{if(t.devMode&&!We(i.schema,t.schema))throw new Error("storage was already created with a different schema");i.refCount=i.refCount+1}var s=new Jh(e,t.databaseName,t.collectionName,t.schema,i,t.options,r);return Promise.resolve(s)}var Yh=new Map;function Xh(e={}){var t={name:"memory",rxdbVersion:Ci,collectionStates:Yh,createStorageInstance(r){zl(r);var n=Object.assign({},e,r.options);return Vh(this,r,n)}};return t}var mi={UT1:"given name is no string or empty",UT2:`collection- and database-names must match the regex to be compatible with couchdb databases.
    See https://neighbourhood.ie/blog/2020/10/13/everything-you-need-to-know-about-couchdb-database-names/
    info: if your database-name specifies a folder, the name must contain the slash-char '/' or '\\'`,UT3:"replication-direction must either be push or pull or both. But not none",UT4:"given leveldown is no valid adapter",UT5:"keyCompression is set to true in the schema but no key-compression handler is used in the storage",UT6:"schema contains encrypted fields but no encryption handler is used in the storage",UT7:"attachments.compression is enabled but no attachment-compression plugin is used",PL1:"Given plugin is not RxDB plugin.",PL3:"A plugin with the same name was already added but it was not the exact same JavaScript object",P2:"bulkWrite() cannot be called with an empty array",QU1:"RxQuery._execOverDatabase(): op not known",QU4:"RxQuery.regex(): You cannot use .regex() on the primary field",QU5:"RxQuery.sort(): does not work because key is not defined in the schema",QU6:"RxQuery.limit(): cannot be called on .findOne()",QU9:"throwIfMissing can only be used in findOne queries",QU10:"result empty and throwIfMissing: true",QU11:"RxQuery: no valid query params given",QU12:"Given index is not in schema",QU13:"A top level field of the query is not included in the schema",QU14:"Running a count() query in slow mode is now allowed. Either run a count() query with a selector that fully matches an index or set allowSlowCount=true when calling the createRxDatabase",QU15:"For count queries it is not allowed to use skip or limit",QU16:"$regex queries must be defined by a string, not an RegExp instance. This is because RegExp objects cannot be JSON stringified and also they are mutable which would be dangerous",MQ1:"path must be a string or object",MQ2:"Invalid argument",MQ3:"Invalid sort() argument. Must be a string, object, or array",MQ4:"Invalid argument. Expected instanceof mquery or plain object",MQ5:"method must be used after where() when called with these arguments",MQ6:"Can't mix sort syntaxes. Use either array or object | .sort([['field', 1], ['test', -1]]) | .sort({ field: 1, test: -1 })",MQ7:"Invalid sort value",MQ8:"Can't mix sort syntaxes. Use either array or object",DB1:"RxDocument.prepare(): another instance on this adapter has a different password",DB2:"RxDatabase.addCollections(): collection-names cannot start with underscore _",DB3:"RxDatabase.addCollections(): collection already exists. use myDatabase[collectionName] to get it",DB4:"RxDatabase.addCollections(): schema is missing",DB5:"RxDatabase.addCollections(): collection-name not allowed",DB6:"RxDatabase.addCollections(): another instance created this collection with a different schema. Read this https://rxdb.info/questions-answers.html#cant-change-the-schema",DB8:`createRxDatabase(): A RxDatabase with the same name and adapter already exists.
Make sure to use this combination only once or set ignoreDuplicate to true if you do this intentional-
This often happens in react projects with hot reload that reloads the code without reloading the process.`,DB11:"createRxDatabase(): Invalid db-name, folder-paths must not have an ending slash",DB12:"RxDatabase.addCollections(): could not write to internal store",DB13:"createRxDatabase(): Invalid db-name or collection name, name contains the dollar sign",DB14:"no custom reactivity factory added on database creation",COL1:"RxDocument.insert() You cannot insert an existing document",COL2:"RxCollection.insert() fieldName ._id can only be used as primaryKey",COL3:"RxCollection.upsert() does not work without primary",COL4:"RxCollection.incrementalUpsert() does not work without primary",COL5:"RxCollection.find() if you want to search by _id, use .findOne(_id)",COL6:"RxCollection.findOne() needs a queryObject or string",COL7:"hook must be a function",COL8:"hooks-when not known",COL9:"RxCollection.addHook() hook-name not known",COL10:"RxCollection .postCreate-hooks cannot be async",COL11:"migrationStrategies must be an object",COL12:"A migrationStrategy is missing or too much",COL13:"migrationStrategy must be a function",COL14:"given static method-name is not a string",COL15:"static method-names cannot start with underscore _",COL16:"given static method is not a function",COL17:"RxCollection.ORM: statics-name not allowed",COL18:"collection-method not allowed because fieldname is in the schema",COL20:"Storage write error",CONFLICT:"Document update conflict. When changing a document you must work on the previous revision",DOC1:"RxDocument.get$ cannot get observable of in-array fields because order cannot be guessed",DOC2:"cannot observe primary path",DOC3:"final fields cannot be observed",DOC4:"RxDocument.get$ cannot observe a non-existed field",DOC5:"RxDocument.populate() cannot populate a non-existed field",DOC6:"RxDocument.populate() cannot populate because path has no ref",DOC7:"RxDocument.populate() ref-collection not in database",DOC8:"RxDocument.set(): primary-key cannot be modified",DOC9:"final fields cannot be modified",DOC10:"RxDocument.set(): cannot set childpath when rootPath not selected",DOC11:"RxDocument.save(): can't save deleted document",DOC13:"RxDocument.remove(): Document is already deleted",DOC14:"RxDocument.destroy() does not exist",DOC15:"query cannot be an array",DOC16:"Since version 8.0.0 RxDocument.set() can only be called on temporary RxDocuments",DOC17:"Since version 8.0.0 RxDocument.save() can only be called on non-temporary documents",DOC18:"Document property for composed primary key is missing",DOC19:"Value of primary key(s) cannot be changed",DOC20:"PrimaryKey missing",DOC21:"PrimaryKey must be equal to PrimaryKey.trim(). It cannot start or end with a whitespace",DOC22:"PrimaryKey must not contain a linebreak",DOC23:'PrimaryKey must not contain a double-quote ["]',DOC24:"Given document data could not be structured cloned. This happens if you pass non-plain-json data into it, like a Date() or a Function. In vue.js this happens if you use ref() on the document data which transforms it into a Proxy object.",DM1:"migrate() Migration has already run",DM2:"migration of document failed final document does not match final schema",DM3:"migration already running",DM4:"Migration errored",DM5:"Cannot open database state with newer RxDB version. You have to migrate your database state first. See see https://rxdb.info/migration-storage.html",AT1:"to use attachments, please define this in your schema",EN1:"password is not valid",EN2:"validatePassword: min-length of password not complied",EN3:"Schema contains encrypted properties but no password is given",EN4:"Password not valid",JD1:"You must create the collections before you can import their data",JD2:"RxCollection.importJSON(): the imported json relies on a different schema",JD3:"RxCollection.importJSON(): json.passwordHash does not match the own",LD1:"RxDocument.allAttachments$ can't use attachments on local documents",LD2:"RxDocument.get(): objPath must be a string",LD3:"RxDocument.get$ cannot get observable of in-array fields because order cannot be guessed",LD4:"cannot observe primary path",LD5:"RxDocument.set() id cannot be modified",LD6:"LocalDocument: Function is not usable on local documents",LD7:"Local document already exists",LD8:"localDocuments not activated. Set localDocuments=true on creation, when you want to store local documents on the RxDatabase or RxCollection.",RC1:"Replication: already added",RC2:"replicateCouchDB() query must be from the same RxCollection",RC4:"RxCouchDBReplicationState.awaitInitialReplication() cannot await initial replication when live: true",RC5:"RxCouchDBReplicationState.awaitInitialReplication() cannot await initial replication if multiInstance because the replication might run on another instance",RC6:"syncFirestore() serverTimestampField MUST NOT be part of the collections schema and MUST NOT be nested.",RC7:"SimplePeer requires to have process.nextTick() polyfilled, see https://rxdb.info/replication-webrtc.html",RC_PULL:"RxReplication pull handler threw an error - see .errors for more details",RC_STREAM:"RxReplication pull stream$ threw an error - see .errors for more details",RC_PUSH:"RxReplication push handler threw an error - see .errors for more details",RC_PUSH_NO_AR:"RxReplication push handler did not return an array with the conflicts",RC_WEBRTC_PEER:"RxReplication WebRTC Peer has error",RC_COUCHDB_1:"replicateCouchDB() url must end with a slash like 'https://example.com/mydatabase/'",RC_COUCHDB_2:"replicateCouchDB() did not get valid result with rows.",RC_OUTDATED:"Outdated client, update required. Replication was canceled",RC_UNAUTHORIZED:"Unauthorized client, update the replicationState.headers to set correct auth data",RC_FORBIDDEN:"Client behaves wrong so the replication was canceled. Mostly happens if the client tries to write data that it is not allowed to",SC1:"fieldnames do not match the regex",SC2:"SchemaCheck: name 'item' reserved for array-fields",SC3:"SchemaCheck: fieldname has a ref-array but items-type is not string",SC4:"SchemaCheck: fieldname has a ref but is not type string, [string,null] or array<string>",SC6:"SchemaCheck: primary can only be defined at top-level",SC7:"SchemaCheck: default-values can only be defined at top-level",SC8:"SchemaCheck: first level-fields cannot start with underscore _",SC10:"SchemaCheck: schema defines ._rev, this will be done automatically",SC11:"SchemaCheck: schema needs a number >=0 as version",SC13:"SchemaCheck: primary is always index, do not declare it as index",SC14:"SchemaCheck: primary is always unique, do not declare it as index",SC15:"SchemaCheck: primary cannot be encrypted",SC16:"SchemaCheck: primary must have type: string",SC17:"SchemaCheck: top-level fieldname is not allowed",SC18:"SchemaCheck: indexes must be an array",SC19:"SchemaCheck: indexes must contain strings or arrays of strings",SC20:"SchemaCheck: indexes.array must contain strings",SC21:"SchemaCheck: given index is not defined in schema",SC22:"SchemaCheck: given indexKey is not type:string",SC23:"SchemaCheck: fieldname is not allowed",SC24:"SchemaCheck: required fields must be set via array. See https://spacetelescope.github.io/understanding-json-schema/reference/object.html#required",SC25:"SchemaCheck: compoundIndexes needs to be specified in the indexes field",SC26:"SchemaCheck: indexes needs to be specified at collection schema level",SC27:"SchemaCheck: encrypted fields need to be specified at collection schema level",SC28:"SchemaCheck: encrypted fields is not defined in the schema",SC29:"SchemaCheck: missing object key 'properties'",SC30:"SchemaCheck: primaryKey is required",SC32:"SchemaCheck: primary field must have the type string/number/integer",SC33:"SchemaCheck: used primary key is not a property in the schema",SC34:"Fields of type string that are used in an index, must have set the maxLength attribute in the schema",SC35:"Fields of type number/integer that are used in an index, must have set the multipleOf attribute in the schema",SC36:"A field of this type cannot be used as index",SC37:"Fields of type number that are used in an index, must have set the minimum and maximum attribute in the schema",SC38:"Fields of type boolean that are used in an index, must be required in the schema",SC39:"The primary key must have the maxLength attribute set",SC40:"$ref fields in the schema are not allowed. RxDB cannot resolve related schemas because it would have a negative performance impact.It would have to run http requests on runtime. $ref fields should be resolved during build time.",SC41:"minimum, maximum and maxLength values for indexes must be real numbers, not Infinity or -Infinity",VD1:"Sub-schema not found, does the schemaPath exists in your schema?",VD2:"object does not match schema",S1:"You cannot create collections after calling RxDatabase.server()",GQL1:"GraphQL replication: cannot find sub schema by key",GQL3:"GraphQL replication: pull returns more documents then batchSize",CRDT1:"CRDT operations cannot be used because the crdt options are not set in the schema.",CRDT2:"RxDocument.incrementalModify() cannot be used when CRDTs are activated.",CRDT3:"To use CRDTs you MUST NOT set a conflictHandler because the default CRDT conflict handler must be used",SNH:"This should never happen"},gr;function Zh(){if(!gr){var e=new pn,t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(Object.getPrototypeOf(e));gr=[...t,...r]}return gr}var br;function ed(){if(!br){var e=new yn("pseudoInstance","memory"),t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(Object.getPrototypeOf(e));br=[...t,...r],e.destroy()}return br}var td=Vs(_t),rd=new td,wr;function Eo(){if(!wr){var e=["deleted","synced"],t=Object.getOwnPropertyNames(rd),r=Object.getOwnPropertyNames(_t);wr=[...t,...r,...e]}return wr}function nd(e){if(e!=="_deleted"){if(["properties"].includes(e))throw m("SC23",{fieldName:e});var t="^[a-zA-Z](?:[[a-zA-Z0-9_]*]?[a-zA-Z0-9])?$",r=new RegExp(t);if(e!=="_id"&&!e.match(r))throw m("SC1",{regex:t,fieldName:e})}}function id(e){var t=ce(e.primaryKey);function r(i,s,o){if(typeof i=="string"&&typeof s=="object"&&!Array.isArray(s)&&o.split(".").pop()!=="patternProperties"&&nd(i),Object.prototype.hasOwnProperty.call(s,"item")&&s.type!=="array")throw m("SC2",{fieldName:i});if(Object.prototype.hasOwnProperty.call(s,"required")&&typeof s.required=="boolean")throw m("SC24",{fieldName:i});if(Object.prototype.hasOwnProperty.call(s,"$ref"))throw m("SC40",{fieldName:i});if(Object.prototype.hasOwnProperty.call(s,"ref"))if(Array.isArray(s.type)){if(s.type.length>2||!s.type.includes("string")||!s.type.includes("null"))throw m("SC4",{fieldName:i})}else switch(s.type){case"string":break;case"array":if(!s.items||!s.items.type||s.items.type!=="string")throw m("SC3",{fieldName:i});break;default:throw m("SC4",{fieldName:i})}var a=o.split(".").length>=2;if(a&&s.default)throw m("SC7",{path:o});if(!a){if(i==="_id"&&t!=="_id")throw m("COL2",{fieldName:i});if(i.charAt(0)==="_"){if(i==="_id"||i==="_deleted")return;throw m("SC8",{fieldName:i})}}}function n(i,s){!i||typeof i!="object"||Object.keys(i).forEach(o=>{var a=i[o];!i.properties&&a&&typeof a=="object"&&!Array.isArray(i)&&r(o,a,s);var u=s;o!=="properties"&&(u=u+"."+o),n(a,u)})}return n(e,""),!0}function sd(e){if(!e.primaryKey)throw m("SC30",{schema:e});function t(u){if(!u)throw m("SC33",{schema:e});var c=u.type;if(!c||!["string","number","integer"].includes(c))throw m("SC32",{schema:e,args:{schemaPart:u}})}if(typeof e.primaryKey=="string"){var r=e.primaryKey,n=e.properties[r];t(n)}else{var i=e.primaryKey,s=Z(e,i.key);t(s),i.fields.forEach(u=>{var c=Z(e,u);t(c)})}var o=ce(e.primaryKey),a=e.properties[o];if(a.maxLength){if(!isFinite(a.maxLength))throw m("SC41",{schema:e,args:{primaryPathSchemaPart:a}})}else throw m("SC39",{schema:e,args:{primaryPathSchemaPart:a}})}function pi(e){for(var t=e.split("."),r="",n=0;n<t.length;n+=1)t[n]!=="[]"?r=r.concat(".properties.".concat(t[n])):r=r.concat(".items");return fe(r)}function od(e){if(!e.primaryKey)throw m("SC30",{schema:e});if(!Object.prototype.hasOwnProperty.call(e,"properties"))throw m("SC29",{schema:e});if(e.properties._rev)throw m("SC10",{schema:e});if(!Object.prototype.hasOwnProperty.call(e,"version")||typeof e.version!="number"||e.version<0)throw m("SC11",{version:e.version});if(id(e),sd(e),Object.keys(e.properties).forEach(t=>{var r=e.properties[t];if(t===e.primaryKey){if(e.indexes&&e.indexes.includes(t))throw m("SC13",{value:r,schema:e});if(r.unique)throw m("SC14",{value:r,schema:e});if(e.encrypted&&e.encrypted.includes(t))throw m("SC15",{value:r,schema:e});if(r.type!=="string")throw m("SC16",{value:r,schema:e})}if(Eo().includes(t))throw m("SC17",{key:t,schema:e})}),e.indexes){if(!Ue(e.indexes))throw m("SC18",{indexes:e.indexes,schema:e});e.indexes.forEach(t=>{if(!(typeof t=="string"||Array.isArray(t)))throw m("SC19",{index:t,schema:e});if(Array.isArray(t)){for(var r=0;r<t.length;r+=1)if(typeof t[r]!="string")throw m("SC20",{index:t,schema:e})}var n=Ue(t)?t:[t];n.forEach(i=>{var s=Z(e,i),o=s.type;switch(o){case"string":var a=s.maxLength;if(!a)throw m("SC34",{index:t,field:i,schema:e});break;case"number":case"integer":var u=s.multipleOf;if(!u)throw m("SC35",{index:t,field:i,schema:e});var c=s.maximum,l=s.minimum;if(typeof c>"u"||typeof l>"u")throw m("SC37",{index:t,field:i,schema:e});if(!isFinite(c)||!isFinite(l))throw m("SC41",{index:t,field:i,schema:e});break;case"boolean":var f="",h=i;if(i.includes(".")){var d=i.split(".");h=d.pop(),f=d.join(".")}var v=f===""?e:Z(e,f);if(!v.required||!v.required.includes(h))throw m("SC38",{index:t,field:i,schema:e});break;default:throw m("SC36",{fieldName:i,type:s.type,schema:e})}})})}Object.keys(Dr(e)).map(t=>{var r=t.split(".");return r.pop(),r.join(".")}).filter(t=>t!=="").filter((t,r,n)=>n.indexOf(t)===r).filter(t=>{var r=he(e,t);return r&&!!r.index}).forEach(t=>{throw t=t.replace("properties.",""),t=t.replace(/\.properties\./g,"."),m("SC26",{index:fe(t),schema:e})}),(e.indexes||[]).reduce((t,r)=>(Ue(r)?at(t,r):t.push(r),t),[]).filter((t,r,n)=>n.indexOf(t)===r).map(t=>{var r=pi(t),n=he(e,r);if(!n||typeof n!="object")throw m("SC21",{index:t,schema:e});return{indexPath:t,schemaObj:n}}).filter(t=>t.schemaObj.type!=="string"&&t.schemaObj.type!=="integer"&&t.schemaObj.type!=="number"&&t.schemaObj.type!=="boolean").forEach(t=>{throw m("SC22",{key:t.indexPath,type:t.schemaObj.type,schema:e})}),Object.keys(Dr(e)).map(t=>{var r=t.split(".");return r.pop(),r.join(".")}).filter(t=>t!==""&&t!=="attachments").filter((t,r,n)=>n.indexOf(t)===r).filter(t=>{var r=he(e,t);return r&&!!r.encrypted}).forEach(t=>{throw t=t.replace("properties.",""),t=t.replace(/\.properties\./g,"."),m("SC27",{index:fe(t),schema:e})}),e.encrypted&&e.encrypted.forEach(t=>{var r=pi(t),n=he(e,r);if(!n||typeof n!="object")throw m("SC28",{field:t,schema:e})})}function _r(e){e&&Object.entries(e).forEach(([t,r])=>{if(typeof t!="string")throw z("COL14",{name:t});if(t.startsWith("_"))throw z("COL15",{name:t});if(typeof r!="function")throw z("COL16",{name:t,type:typeof t});if(Zh().includes(t)||Eo().includes(t))throw m("COL17",{name:t})})}function ad(e,t){var r=Object.keys(e.properties);t&&Object.keys(t).filter(n=>r.includes(n)).forEach(n=>{throw m("COL18",{funName:n})})}function ud(e,t){if(typeof t!="object"||Array.isArray(t))throw z("COL11",{schema:e});var r=$a(e);if(r.length!==Object.keys(t).length)throw m("COL12",{have:Object.keys(t),should:r});return r.map(n=>({v:n,s:t[n+1]})).filter(n=>typeof n.s!="function").forEach(n=>{throw z("COL13",{version:n.v,type:typeof n,schema:e})}),!0}function cd(e){if(ed().includes(e.name))throw m("DB5",{name:e.name});Co(e.name)}function ld(e){if(Co(e.name),e.name.includes("$"))throw m("DB13",{name:e.name});if(Ei(e.name)&&(e.name.endsWith("/")||e.name.endsWith("\\")))throw m("DB11",{name:e.name})}var So="^[a-z][_$a-z0-9\\-]*$",fd=new RegExp(So);function Co(e){if(typeof e!="string"||e.length===0)throw z("UT1",{name:e});if(Ei(e))return!0;if(!e.match(fd)&&e!==":memory:")throw m("UT2",{regex:So,givenName:e});return!0}function hd(e){var t=Object.prototype.toString.call(e.queryObj)==="[object Object]";if(!t)throw z("QU11",{op:e.op,collection:e.collection.name,queryObj:e.queryObj});var r=["selector","limit","skip","sort","index"];if(Object.keys(e.queryObj).forEach(n=>{if(!r.includes(n))throw z("QU11",{op:e.op,collection:e.collection.name,queryObj:e.queryObj,key:n,args:{validKeys:r}})}),e.op==="count"&&(e.queryObj.limit||e.queryObj.skip))throw m("QU15",{collection:e.collection.name,query:e.queryObj});Qt(e.queryObj)}function dd(e){var t=e.rxQuery.collection.schema.jsonSchema,r=e.mangoQuery.selector,n=Object.keys(t.properties);Object.keys(r).filter(a=>!a.startsWith("$")).filter(a=>!a.includes(".")).forEach(a=>{if(!n.includes(a))throw m("QU13",{schema:t,field:a,query:e.mangoQuery})});var i=t.indexes?t.indexes:[],s=e.mangoQuery.index;if(s){var o=i.find(a=>We(a,s));if(!o)throw m("QU12",{collection:e.rxQuery.collection.name,query:e.mangoQuery,schema:t})}if(e.rxQuery.op==="count"&&!md(e.rxQuery.collection.schema.jsonSchema,e.mangoQuery)&&!e.rxQuery.collection.database.allowSlowCount)throw m("QU14",{collection:e.rxQuery.collection,query:e.mangoQuery});e.mangoQuery.sort&&e.mangoQuery.sort.map(a=>Object.keys(a)[0]).filter(a=>!a.includes(".")).forEach(a=>{if(!n.includes(a))throw m("QU13",{schema:t,field:a,query:e.mangoQuery})}),Qt(e.mangoQuery)}function md(e,t){var r=hn(e,t);return r.queryPlan.selectorSatisfiedByIndex}function Qt(e){if(!(typeof e!="object"||e===null)){var t=Object.keys(e);t.forEach(r=>{var n=e[r];if(n instanceof RegExp)throw m("QU16",{field:r,query:e});Array.isArray(n)?n.forEach(i=>Qt(i)):Qt(n)})}}function pd(e,t){if(!e)throw m("DOC20",{primaryKey:e,document:t});if(e!==e.trim())throw m("DOC21",{primaryKey:e,document:t});if(e.includes("\r")||e.includes(`
`))throw m("DOC22",{primaryKey:e,document:t});if(e.includes('"'))throw m("DOC23",{primaryKey:e,document:t})}function vd(e){return!e||typeof e=="string"||typeof e=="number"?e:bi(e)}var yd="dev-mode",gd={name:yd,rxdb:!0,init:()=>{console.warn(["-------------- RxDB dev-mode warning -------------------------------","you are seeing this because you use the RxDB dev-mode plugin https://rxdb.info/dev-mode.html ","This is great in development mode, because it will run many checks to ensure","that you use RxDB correct. If you see this in production mode,","you did something wrong because the dev-mode plugin will decrease the performance.","","🤗 Hint: To get the most out of RxDB, check out the Premium Plugins","to get access to faster storages and more professional features: https://rxdb.info/premium","","You can disable this warning by calling disableWarnings() from the dev-mode plugin.","---------------------------------------------------------------------"].join(`
`))},overwritable:{isDevMode(){return!0},deepFreezeWhenDevMode:vd,tunnelErrorMessage(e){if(!mi[e])throw console.error("RxDB: Error-Code not known: "+e),new Error("Error-Code "+e+" not known, contact the maintainer");return mi[e]}},hooks:{preCreateRxSchema:{after:od},preCreateRxDatabase:{after:function(e){ld(e)}},preCreateRxCollection:{after:function(e){if(cd(e),ad(e.schema,e.methods),e.name.charAt(0)==="_")throw m("DB2",{name:e.name});if(!e.schema)throw m("DB4",{name:e.name,args:e})}},createRxDocument:{before:function(e){pd(e.primary,e.toJSON(!0))}},preCreateRxQuery:{after:function(e){hd(e)}},prePrepareQuery:{after:e=>{dd(e)}},createRxCollection:{after:e=>{_r(e.creator.statics),_r(e.creator.methods),_r(e.creator.attachments),e.creator.schema&&e.creator.migrationStrategies&&ud(e.creator.schema,e.creator.migrationStrategies)}}}};const Xt=e=>B((t,r,n)=>{let i=0;if(r instanceof Array)for(const s of r)i=i|1<<s;else i=r;return e(t&i,i)}),bd=Xt((e,t)=>e==0),wd=Xt((e,t)=>e==t),_d=Xt((e,t)=>e<t),Od=Xt((e,t)=>e>0),Ed=Object.freeze(Object.defineProperty({__proto__:null,$all:vl,$and:Cs,$bitsAllClear:bd,$bitsAllSet:wd,$bitsAnyClear:_d,$bitsAnySet:Od,$elemMatch:Bs,$eq:xs,$exists:Us,$expr:dl,$gt:Is,$gte:Ps,$in:ks,$jsonSchema:ml,$lt:Ms,$lte:As,$mod:$s,$ne:Ls,$nin:Ts,$nor:Rs,$not:Ds,$or:ln,$regex:Ns,$size:Fs,$type:qs,$where:pl},Symbol.toStringTag,{value:"Module"})),En=(e,t)=>{switch(e){case"deep":return Ar(t);case"copy":return Lr(t)?new Date(t):k(t)?[...t]:D(t)?Object.assign({},t):t;default:return t}},Sd=/^[a-z]+[a-zA-Z0-9]*$/;function Ro(e){if(!e.includes(".$"))return[{parent:e,selector:e},[]];const t=e.indexOf(".$"),r=e.indexOf("]"),n=e.substring(0,t),i=e.substring(t+3,r);P(i===""||Sd.test(i),"The filter <identifier> must begin with a lowercase letter and contain only alphanumeric characters.");const s=e.substring(r+2),[o,a]=s?Ro(s):[];return[{selector:e,parent:n,child:i||"$",next:o},[i,...a||[]].filter(Boolean)]}const U=(e,t,r,n,i)=>{const{parent:s,child:o,next:a}=t;if(!o){let c=!1;return dt(e,s,(f,h)=>c=!!n(f,h)||c,i),c}const u=Xe(e,s);return k(u)?u.map((c,l)=>r[o]&&!r[o].test({[o]:c})?!1:a?U(c,a,r,n,i):n(u,l)).some(Boolean):!1};function K(e,t,r,n){const i=[];for(const[s,o]of Object.entries(e)){const[a,u]=Ro(s);if(!u.length)n(o,a,{})&&i.push(a.parent);else{const c={};t.forEach(f=>{Object.keys(f).forEach(h=>{u.forEach(d=>{(h===d||h.startsWith(d+"."))&&(c[d]=c[d]||{},Object.assign(c[d],{[h]:f[h]}))})})});const l={};for(const[f,h]of Object.entries(c))l[f]=new ae(h,r.queryOptions);n(o,a,l)&&i.push(a.parent)}}return i}const Cd=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>{const a={$each:[i]};return D(i)&&W(i,"$each")&&Object.assign(a,i),U(e,s,o,(u,c)=>{const l=u[c]||(u[c]=[]);return un([l,a.$each]).length===a.$each.length?!1:(u[c]=En(n.cloneMode,Dc(l.concat(a.$each))),!0)},{buildGraph:!0})}),Rd=new Set(["and","or","xor"]),Dd=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>{const a=Object.keys(i);return P(a.length===1&&Rd.has(a[0]),`Invalid bit operator '${a[0]}'. Must be one of 'and', 'or', or 'xor'.`),U(e,s,o,(u,c)=>{let l=u[c];const f=i[a[0]];if(l!==void 0&&!(j(l)&&j(f)))return!1;switch(l=l||0,a[0]){case"and":u[c]=l&f;break;case"or":u[c]=l|f;break;case"xor":u[c]=l^f;break}return u[c]!==l},{buildGraph:!0})}),xd=(e,t,r=[],n={})=>{const i=Date.now();return K(t,r,n,(s,o,a)=>U(e,o,a,(u,c)=>(u[c]=i,!0),{buildGraph:!0}))},Id=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>{if(!s.child){const a=Xe(e,s.parent);P(a===void 0||j(a),"cannot apply $inc to a value of non-numeric type")}return U(e,s,o,(a,u)=>(a[u]=(a[u]||(a[u]=0))+i,!0),{buildGraph:!0})}),Pd=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>U(e,s,o,(a,u)=>a[u]!==void 0&&F(a[u],i)>-1?!1:(a[u]=i,!0),{buildGraph:!0})),kd=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>U(e,s,o,(a,u)=>a[u]!==void 0&&F(a[u],i)<1?!1:(a[u]=i,!0),{buildGraph:!0})),Md=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>U(e,s,o,(a,u)=>{const c=a[u];return a[u]=a[u]===void 0?0:a[u]*i,a[u]!==c},{buildGraph:!0})),Ad=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>U(e,s,o,(a,u)=>{const c=a[u];return P(k(c),`path '${s.selector}' contains an element of non-array type.`),c.length?(i===-1?c.splice(0,1):c.pop(),!0):!1})),Do=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>{const a=!D(i)||Object.keys(i).some(Be),u=new ae(a?{k:i}:i,n.queryOptions),c=a?l=>u.test({k:l}):l=>u.test(l);return U(e,s,o,(l,f)=>{const h=l[f],d=new Array;return h.map(p=>{const g=c(p);return g||d.push(p),g}).some(Boolean)?(l[f]=d,!0):!1})}),Ld=(e,t,r=[],n={})=>{const i={};return Object.entries(t).forEach(([s,o])=>{i[s]={$in:o}}),Do(e,i,r,n)},Td=Object.freeze(["$each","$slice","$sort","$position"]),$d=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>{const a={$each:[i]};return D(i)&&Td.some(u=>W(i,u))&&Object.assign(a,i),U(e,s,o,(u,c)=>{const l=u[c]||(u[c]=[]),f=l.slice(0,a.$slice||l.length),h=l.length,d=j(a.$position)?a.$position:l.length;if(l.splice(d,0,...En(n.cloneMode,a.$each)),a.$sort){const v=D(a.$sort)?Object.keys(a.$sort||{}).pop():"",p=v?a.$sort[v]:a.$sort,g=v?b=>Xe(b,v):b=>b;l.sort((b,y)=>p*F(g(b),g(y)))}return j(a.$slice)&&(a.$slice<0?l.splice(0,l.length+a.$slice):l.splice(a.$slice)),h!=l.length||!oe(f,l)},{descendArray:!0,buildGraph:!0})}),xo=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>U(e,s,o,(a,u)=>oe(a[u],i)?!1:(a[u]=En(n.cloneMode,i),!0),{buildGraph:!0})),Nd=(e,t,r=[],n={})=>{const i=[],s=K(t,r,n,(o,a,u)=>U(e,a,u,(c,l)=>W(c,l)?(i.push(...xo(e,{[o]:c[l]},r,n)),delete c[l],!0):!1));return Array.from(new Set(s.concat(i)))},Bd=(e,t,r=[],n={})=>K(t,r,n,(i,s,o)=>U(e,s,o,(a,u)=>W(a,u)?(k(a)?a[u]=null:delete a[u],!0):!1)),vi=Object.freeze(Object.defineProperty({__proto__:null,$addToSet:Cd,$bit:Dd,$currentDate:xd,$inc:Id,$max:Pd,$min:kd,$mul:Md,$pop:Ad,$pull:Do,$pullAll:Ld,$push:$d,$rename:Nd,$set:xo,$unset:Bd},Symbol.toStringTag,{value:"Module"}));function Io(e){return e=Object.assign(Object.assign({},e),{queryOptions:qt(e.queryOptions)}),e.queryOptions.context.addQueryOps(Ed).addExpressionOps(tl).addExpressionOps(cl),(t,r,n=[],i={},s={})=>{const o=Object.assign({cloneMode:"copy"},e,s);Object.assign(o,{queryOptions:qt(Object.assign({useStrictMode:!1},o==null?void 0:o.queryOptions))}),n=n||[],i=i||{};const a=Object.entries(r);P(a.length===1,"Update expression must contain only one operator.");const[u,c]=a[0];P(W(vi,u),`Update operator '${u}' is not supported.`);const l=vi[u];return Object.keys(i).length&&!(i instanceof ae?i:new ae(i,o.queryOptions)).test(t)?[]:l(t,c,n,o)}}Io({});var Or;function Po(e,t){if(!Or){var r=Io({cloneMode:"none"});Or=(n,i)=>{var s=je(n);return r(s,i),s}}return Or(e,t)}function Fd(e){return this.incrementalModify(t=>{var r=Po(t,e);return r})}function Ud(e){var t=this._data,r=Po(t,e);return this._saveData(r,t)}function qd(e){return this.exec().then(t=>t?Array.isArray(t)?Promise.all(t.map(r=>r.update(e))).then(()=>t):t.update(e).then(()=>t):null)}var jd={name:"update",rxdb:!0,prototypes:{RxDocument:e=>{e.update=Ud,e.incrementalUpdate=Fd},RxQuery:e=>{e.update=qd}}};function Wd(e){var t={name:this.name,instanceToken:this.token,collections:[]},r=Object.keys(this.collections).filter(n=>!e||e.includes(n)).filter(n=>n.charAt(0)!=="_").map(n=>this.collections[n]);return Promise.all(r.map(n=>n.exportJSON())).then(n=>(t.collections=n,t))}var Hd=function(e){var t=e.collections.filter(r=>!this.collections[r.name]).map(r=>r.name);if(t.length>0)throw m("JD1",{missingCollections:t});return Promise.all(e.collections.map(r=>this.collections[r.name].importJSON(r)))},Kd=async function(){var e={name:this.name,schemaHash:await this.schema.hash,docs:[]},t=Fe("find",rt(),this);return zs(t).then(r=>(e.docs=r.map(n=>(n=L(n),delete n._rev,delete n._attachments,n)),e))};async function Qd(e){if(e.schemaHash!==await this.schema.hash)throw m("JD2",{schemaHash:e.schemaHash,own:this.schema.hash});var t=e.docs;return this.storageInstance.bulkWrite(t.map(r=>{var n=Object.assign({},r,{_meta:{lwt:Q()},_rev:mt(),_attachments:{},_deleted:!1});return{document:n}}),"json-dump-import")}var zd={name:"json-dump",rxdb:!0,prototypes:{RxDatabase:e=>{e.exportJSON=Wd,e.importJSON=Hd},RxCollection:e=>{e.exportJSON=Kd,e.importJSON=Qd}},overwritable:{}},Sn={minimumDeletedTime:1e3*60*60*24*31,minimumCollectionAge:1e3*60,runEach:1e3*60*5,awaitReplicationsInSync:!0,waitForLeadership:!0},ko=new WeakMap,Gd=new WeakMap;function yi(e){return be(Gd,e,()=>Mh(e))}function Jd(){var e=Ah(this.storage.name,this.token,this.name,this),t=this.destroy.bind(this);this.destroy=function(){return Lh(this.token,this),t()};var r=yi(e);return r||(r=yi(e),ko.set(this,r)),this.leaderElector=()=>r,r}function Vd(){return this.multiInstance?this.leaderElector().isLeader:!0}function Yd(){return this.multiInstance?this.leaderElector().awaitLeadership().then(()=>!0):ut}function Xd(e){var t=ko.get(e);t&&t.die()}var Zd=!0,em={RxDatabase:e=>{e.leaderElector=Jd,e.isLeader=Vd,e.waitForLeadership=Yd}},tm={name:"leader-election",rxdb:Zd,prototypes:em,hooks:{preDestroyRxDatabase:{after:Xd}}},Mo=new WeakMap,Er=ut;async function rm(e){var t=e.database,r=Object.assign({},Sn,t.cleanupPolicy?t.cleanupPolicy:{});await Ao(e,r),!e.destroyed&&(await Lo(e,r),await nm(e,r))}async function Ao(e,t){await e.promiseWait(t.minimumCollectionAge),!e.destroyed&&t.waitForLeadership&&await e.database.waitForLeadership()}async function Lo(e,t){for(var r=e.database,n=e.storageInstance,i=!1;!i&&!e.destroyed;){if(t.awaitReplicationsInSync){var s=Mo.get(e);s&&await Promise.all(s.map(o=>{if(!o.isStopped())return o.awaitInSync()}))}if(e.destroyed)return;Er=Er.then(async()=>e.destroyed?!0:(await r.requestIdlePromise(),n.cleanup(t.minimumDeletedTime))),i=await Er}}async function nm(e,t){for(;!e.destroyed;){if(await e.promiseWait(t.runEach),e.destroyed)return;await Lo(e,t)}}var Sr=ut;async function im(e){var t=e.collection,r=t.database,n=Object.assign({},Sn,r.cleanupPolicy?r.cleanupPolicy:{});await Ao(t,n),!t.destroyed&&(await To(e,n),await sm(e,n))}async function To(e,t){for(var r=e.collection,n=r.database,i=!1;!i&&!r.destroyed;){if(t.awaitReplicationsInSync){var s=Mo.get(r);s&&await Promise.all(s.map(o=>{if(!o.isStopped())return o.awaitInSync()}))}if(r.destroyed)return;Sr=Sr.then(async()=>r.destroyed?!0:(await n.requestIdlePromise(),e._cleanup())),i=await Sr}}async function sm(e,t){for(var r=e.collection;!r.destroyed;){if(await r.promiseWait(t.runEach),r.destroyed)return;await To(e,t)}}var om={name:"cleanup",rxdb:!0,prototypes:{RxCollection:e=>{e.cleanup=async function(t){var r=Object.assign({},Sn,this.database.cleanupPolicy?this.database.cleanupPolicy:{});typeof t>"u"&&(t=r.minimumDeletedTime);for(var n=!1;!n&&!this.destroyed;)n=await this.storageInstance.cleanup(t)}}},hooks:{createRxCollection:{after:e=>{rm(e.collection)}},createRxState:{after:e=>{im(e.state)}}}};const am={version:0,title:"post schema with indexes",primaryKey:"id",type:"object",properties:{id:{type:"string",maxLength:100},title:{type:"string",maxLength:100},content:{type:"string",maxLength:1e3},userId:{type:"string",maxLength:100},createAt:{type:"string",format:"date-time"}},required:["id","title","content","createAt"],indexes:["userId"]},um=am;let cm=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,r)=>(r&=63,r<36?t+=r.toString(36):r<62?t+=(r-26).toString(36).toUpperCase():r>62?t+="-":t+="_",t),"");const lm={version:0,title:"user schema with indexes",primaryKey:"nanoId",type:"object",properties:{id:{type:"number",default:1},nanoId:{type:"string",maxLength:21},name:{type:"string",maxLength:100},createAt:{type:"string",format:"date-time",maxLength:100}},required:["id","nanoId","name","createAt"],indexes:["name","createAt"]},fm=lm,hm={async removeSelf(){return void await this.collection.bulkRemove([this.nanoId])}},dm={async addUser(e){const t=await this.findOne({sort:[{createAt:"desc"}]}).exec(),r={id:((t==null?void 0:t.id)||0)+1,nanoId:cm(21),name:e.name,createAt:new Date().toISOString()};return await this.insert(r)},async removeUser(e){return this.bulkRemove(e.nanoIds)},async updateUserName(e){return this.findOne({selector:{nanoId:e.nanoId}}).update({$set:{name:e.name}})}};Ot(tm);Ot(gd);Ot(jd);Ot(zd);Ot(om);async function mm(){const e=await bf({name:"example_rxdb",storage:Xh(),multiInstance:!0});return e.waitForLeadership().then(()=>{document.title=`♛ ${document.title}`}),await e.addCollections({users:{schema:fm,methods:hm,statics:dm},posts:{schema:um}}),e}const pm="VUE_RXDB_CONTEXT";function vm(e){return Ho(pm,e),e}function ym(e){const t=Ko(null);return Qo(async()=>(t.value=await e(),()=>{var r;(r=t.value)==null||r.destroy()})),vm({db:t}),t}const wm=zo({setup(){return ym(()=>mm()),()=>Go("div",null,[Jo("233")])}});export{wm as default};
